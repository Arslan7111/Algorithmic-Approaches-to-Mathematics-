# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "ipywidgets==8.1.8",
#     "marimo",
#     "matplotlib==3.10.8",
#     "numpy==2.2.6",
#     "seaborn==0.13.2",
# ]
# ///

import marimo

__generated_with = "0.18.4"
app = marimo.App(
    width="medium",
    app_title="answer template",
    css_file="/usr/local/_marimo/custom.css",
    auto_download=["html"],
)


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # AAM summative assessment answer template (2025-26)
    """)
    return


@app.cell
def _():
    import marimo as mo
    import numpy as np
    import matplotlib.pyplot as plt
    return mo, np, plt


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # Question 1
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part (a)
    """)
    return


@app.cell
def _(np):


    # Step 1: Defining the transformation function
    def my_transf(A):
        return A + A.T

    # Step 2: Define the dot product function for eigenvectors
    def eigprod(A, i, j):
        # The eigenvectors are stored as COLUMNS in the matrix
        evals, evecs = np.linalg.eig(A)

        vi = evecs[:, i] # Selecting the i-th column
        vj = evecs[:, j] # Selecting the j-th column

        return np.dot(vi, vj)

    # Step 3: Execution and Exploration
    # Creating a 4x4 matrix with random floats
    A = np.random.rand(4, 4)

    # Transforming it
    R = my_transf(A)

    # Testing different pairs (i, j)
    val_01 = eigprod(R, 0, 1)
    val_12 = eigprod(R, 1, 2)
    val_00 = eigprod(R, 0, 0) # Dot product with itself

    print(f"Dot product of v0 and v1: {val_01:.16f}")
    print(f"Dot product of v1 and v2: {val_12:.16f}")
    print(f"Dot product of v0 and v0: {val_00:.2f}")
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (d)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    Since $R$ is symmetric ($R = R^T$), the expression $v_i^T(R^T - R)v_j$ is identically zero. By expanding this expression using the eigenvalue equations $R v_j = \lambda_j v_j$ and $v_i^T R = \lambda_i v_i^T$, we get $(\lambda_j - \lambda_i)(v_i \cdot v_j) = 0$. Assuming the eigenvalues are distinct, the dot product must be zero, explaining why the eigenvectors are orthogonal.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (e)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    The eigenvectors are linearly independent. If we assume they are dependent, one could be expressed as a weighted sum of the others. However, taking the dot product of that sum with $v_i$ results in zero (due to the orthogonality proved in Part d), while the dot product of $v_i$ with itself is non-zero. This contradiction proves they must be linearly independent.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (f)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    The dimension of the vector space spanned by these eigenvectors is 4. This conclusion follows directly from the definition of a dimension, which is the number of vectors in a basis for a given space. In Part e, we established that the four eigenvectors $v_1, v_2, v_3, v_4$ are linearly independent because they are orthogonal, a guaranteed property of any real symmetric matrix, such as the one produced by the my_transf(A) function. Since we have a set of four linearly independent vectors existing within a 4-dimensional space ($\mathbb{R}^4$), they must span that space and form a basis. Consequently, the dimension of the subspace spanned by these four independent vectors is exactly 4.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (g)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    There are no values of $\theta$ for which the three given vectors form a basis of $\mathbb{R}^3$. For a set of three vectors to form a basis in 3D space, they must be linearly independent. By examining the components of $u$, $v$, and $w$, we can see that the second ($y$) and third ($z$) components of every vector in the set satisfy the linear relationship $z = -0.5y$. Specifically, in vector $u$, $2 \times -0.5 = -1$; in $v$, $-2 \times -0.5 = 1$; and in $w$, $6 \times -0.5 = -3$.Because this same geometric rule constrains every vector, they are all trapped within a single 2D plane passing through the origin. Furthermore, the trigonometric identity $\cos^2(\theta) + \sin^2(\theta) = 1$ ensures that even as $\theta$ changes, the sum of the first two vectors remains a constant vector $[1, 0, 0]$, which also lies on that same plane. Since the vectors are linearly dependent for all values of $\theta$, they can never span the full 3D volume of $\mathbb{R}^3$ and therefore cannot form a basis.
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # Question 2
    """)
    return


@app.cell(hide_code=True)
def _(np):
    electricity_prices = np.array([[20.53274762837478, 20.00970838537757, 19.878650342006182, 20.12669457763914, 21.657272966898717, 21.422781677567183, 20.043307045053727, 19.704744872595573, 18.499720992088236, 19.63772377488589, 19.942480872162076, 20.19481590558498, 22.543612952157737, 21.963869207868118, 20.711648284091734, 19.089031378347048, 18.903082407780083, 19.18588720406254, 17.792362180435042, 18.532539105621023, 18.83338407060952, 18.77654142314025, 19.809624667684382, 20.6098653026023],[20.652499135757022, 21.203001009883014, 21.360597442098626, 20.42606750235887, 19.594534604528857, 19.38250494918799, 20.464831427091006, 19.98318115943846, 19.51233930850471, 19.3271608619765, 20.544484153443747, 19.256661390736074, 20.042447440180034, 19.930480729976566, 20.677951705616373, 19.31462940303348, 23.173818054790907, 22.457979624395726, 21.380120720370943, 22.404025619016586, 23.55842600839864, 22.96002589651992, 23.418042764036162, 23.354361768767863],[22.77367119540807, 21.354448413589893, 21.961582173766324, 22.449030559116792, 23.125975900364402, 21.367006562630426, 22.380451515960914, 22.613719292514244, 23.782069831935523, 23.531406552076728, 22.634182989172512, 21.958799475356617, 20.984550118256333, 21.95679237689334, 21.91306183035822, 21.792025323967483, 21.87384925236414, 22.068518155719705, 20.616968064390196, 21.152627061825456, 21.04375699503386, 20.382769491380884, 20.53297473892693, 20.506424786714604],[20.898724707968864, 20.917701629994706, 20.713476144557223, 21.70001982859578, 20.424610055204734, 20.358791456501425, 19.510182841507106, 19.99278103542896, 20.895819976567395, 21.22498388776119, 20.932719855288674, 20.793313757929646, 21.05701708036207, 22.03151493452877, 21.626892947730436, 22.53024769523569, 19.73309145424631, 19.99441257594262, 18.834194871628732, 20.12931554331545, 20.22915979946433, 19.71024587254328, 19.407170146159107, 20.57766156504189],[20.598718134550115, 20.30346523222706, 20.252405385953466, 19.483006180680622, 19.92658192300776, 20.297289632578668, 20.08552482251126, 19.941498803783258, 20.170450542370663, 20.678471614447023, 19.998057249717448, 19.902794312463307, 18.80139291823445, 19.15766810364084, 19.72631287405733, 19.709631308719977, 20.445827322760017, 19.41802521973308, 20.262334326243327, 20.927599008917582, 19.864533508717244, 19.70038579896335, 20.48902801932477, 20.815411887886636],[20.549173396852957, 20.942406049600145, 19.536797445741634, 20.870091704166924, 21.606501046313078, 21.764709269969995, 22.75702294236071, 23.42568233224445, 22.59351342564482, 23.3769001114366, 23.734171111623464, 23.136908837407137, 23.113545408832557, 21.819451686484406, 21.079829329145376, 22.846902729579572, 19.377455516060277, 22.39271443638687, 21.712829964557496, 21.772833371710213, 21.459868095809398, 20.115574115619523, 19.71881615817101, 18.1127499201671],[18.569999915603237, 18.439337674728506, 19.317598087228923, 19.767538613859195, 20.081877651816995, 21.193613217415812, 21.79833936941659, 22.111313745154682, 20.99154732166254, 22.03770077094311, 21.245091192356167, 21.231355607005234, 19.82738051542334, 18.99968051162297, 20.54134184683851, 17.699411878160788, 17.904424992251933, 19.164795820926045, 19.471115115937163, 19.285669563361957, 19.603581038590683, 20.112143211702804, 20.425096544087406, 20.98421549999908],[20.693077637378032, 19.418444992503975, 20.292903179156344, 19.107863342949532, 18.770874064231172, 19.950675587001555, 20.682438966471263, 21.895234535391747, 22.04822798333415, 22.260291805148977, 21.654419262627325, 23.201136613479065, 23.27364832519343, 22.83775380298408, 22.957301159263455, 22.910803646504995, 21.772766544057646, 19.069487827039147, 21.26420346698465, 21.213299695479154, 22.121525061849304, 23.102986071874724, 20.77453965491834, 22.018676998271083],[21.931856557418627, 22.397297268395192, 22.643693368661328, 21.721747472550824, 21.27744532423499, 21.11808790207722, 20.474392515040176, 20.637894105813146, 20.242302296785166, 19.634539851569546, 20.230260474125483, 21.71806717437728, 22.113786234710304, 22.95714915628377, 22.84382042758411, 25.827734989365755, 24.79783077303679, 23.27081774778967, 22.906843176072552, 22.030749106840485, 21.069574578617527, 19.382595156334723, 20.433095565242652, 21.83251130746163],[21.66908213535921, 22.104115195521697, 22.37901173737488, 21.50761713623366, 21.061484126339934, 20.52882607816883, 20.794971847334104, 19.987091229406065, 21.33145040626558, 21.191317498835172, 20.981005221905644, 20.854031618413302, 21.20710537257665, 20.643095652032848, 22.821439448634543, 24.470740076848905, 23.70731263583555, 22.710424607558203, 22.453637306248254, 23.127950751375604, 23.35102060155928, 23.679840688792268, 24.218640730730467, 22.99623748254358],[22.56229412762032, 22.84474845309141, 24.176114430468544, 24.85867771588413, 26.598932892946678, 25.616554448288216, 24.163882476516306, 22.43229828199047, 22.381684932031906, 23.354155456635443, 21.85862386454385, 23.25328335533542, 22.595360696672024, 22.002851744974496, 21.168124884210915, 22.919757394261094, 23.71374123119312, 25.73153617079925, 20.42148576177786, 21.574572485839404, 23.525457332794446, 22.115134248161997, 21.296079548070526, 20.95347633563029],[20.752947817192844, 20.531441629738744, 21.58596360072967, 20.340664681015582, 18.830485981670243, 19.330877875339997, 19.70518792636892, 20.204792475977353, 20.925094075869897, 21.35428308378051, 22.041833624717565, 21.631947265980614, 20.856908712026307, 20.319407368838704, 21.53338822005231, 22.552702073135215, 22.118067241723786, 21.95208968547457, 20.180321192409114, 19.763448690138755, 18.61731775860145, 18.910818684406838, 18.67222447317931, 18.409183272482625],[18.775351149440038, 18.581219901915027, 19.203505892680067, 19.541307607595126, 18.448355395081112, 18.28426665416248, 18.881472806231162, 20.705861224330537, 20.57572959981538, 21.550097475236235, 22.898451220619915, 22.117175642249478, 20.906236151897687, 22.219726735062373, 21.506741608915785, 20.254637773248508, 22.596845193428052, 21.202738318488667, 20.37241522316651, 20.090921721840004, 20.747393245681113, 21.038687847819755, 20.227169919992267, 21.915279367811067],[21.580303360469046, 22.856604254379572, 20.990016081933604, 21.677846194244545, 21.637119978713496, 23.971169294008618, 23.206433676356234, 23.125731822469895, 23.38196522839123, 22.736882207483788, 22.0193147813449, 21.836581337277345, 21.046282011600734, 20.867296312522306, 21.807499686094264, 25.403272805403887, 25.167570468368854, 24.915263121620352, 22.62388526795584, 24.42713879077756, 24.179072784294913, 23.736845387611414, 23.914869163738906, 23.472762652227427],[22.58866303658794, 22.78266432461353, 22.8838808935944, 22.832639985160842, 22.902595389761984, 22.85419850547792, 23.17234915620378, 22.147190085784302, 22.501839653292958, 23.585154077007143, 23.3091169794581, 21.182897413441232, 22.180984287621683, 21.61950473023568, 22.448950705378216, 23.613166107999668, 25.341833711852384, 23.376030445079735, 22.661805971348887, 23.394039719956126, 23.810776966222857, 23.38771720925687, 22.61265169439043, 20.89416021586068],[20.56754544084819, 20.437306745615928, 21.225964991248244, 20.92772234942845, 22.215375506742117, 21.993930082244756, 22.38587967080296, 21.47645134801298, 20.392175901011242, 20.217014869982258, 19.849800277940354, 20.016909421132066, 21.01133325057505, 21.01966502515188, 22.188970914216384, 21.94512363378913, 23.14246773628352, 20.29682439713231, 21.553051758337524, 22.887828939660267, 21.357539916521752, 21.25836292029763, 21.695231657854144, 21.437668876810438],[21.514102082123614, 20.483967479354032, 20.223486622311874, 22.462300484330456, 21.66108913061873, 20.338094915213883, 19.899424196142725, 19.469917075610102, 20.595416791676335, 20.847798731438218, 20.096547234394453, 19.926162827020224, 20.557751176427608, 20.3319307149046, 21.267777103114728, 22.960637269471192, 21.695868362046152, 23.3450034136907, 21.547125059035086, 21.168862075494918, 20.54578806714383, 21.05633184866793, 21.240313846801502, 20.650543622616162],[20.791118809208683, 22.494290255841815, 21.877102515023413, 21.263595844405966, 21.007596185846957, 21.19994707625534, 21.28395791885744, 20.97052786042662, 20.069334879978758, 20.907876294063065, 21.849462391195907, 22.952451675479296, 22.267330139793238, 23.534556662087997, 23.64376577485036, 24.683886229876155, 23.1017953576418, 21.183829505506733, 20.771248016560833, 19.886105211043358, 19.079661881727613, 18.022897825666348, 18.919686254316368, 19.92392913291343],[20.069927402289448, 20.848263356138602, 21.097014193958692, 21.774214419992077, 22.216831483402878, 20.91486073391253, 21.817245374825557, 22.1937238861608, 21.32643166135574, 20.50130386930533, 20.197193565809535, 20.484139831111385, 20.90194955527573, 21.072840218496193, 21.411827013201147, 21.66301267990623, 23.95925525681646, 23.905523221199704, 20.108711903515804, 20.503064489152464, 19.96640942567034, 20.306254995559993, 19.89660267193042, 20.627985274404622],[20.323054381804795, 20.370865975506703, 20.442337792225267, 20.545671299063834, 21.44023329798696, 22.49973418283069, 22.098158338709847, 21.62964774892317, 21.382052643248006, 20.491197588679306, 20.1515841540466, 21.508283122748576, 20.808720971763538, 20.58465993942084, 20.406433367493317, 21.691512961203756, 21.529533677608473, 23.676035840840157, 21.285549916981786, 20.211074350296965, 19.659015753226274, 20.18737382072691, 22.03962837906356, 22.071540021761127],[21.79310866460455, 21.731452670300378, 20.393306946631462, 20.538224290666008, 21.285543067679107, 21.37058419657834, 21.05586817661273, 20.399694510938907, 19.340368090350264, 20.093271846950064, 19.00622659292036, 20.17316345720118, 19.98980575811136, 21.643366212865526, 20.61647323640631, 20.392147067385952, 21.603881236746297, 21.895678083570065, 21.525827440172165, 21.401448524040582, 21.40227601334078, 20.546227874397406, 19.907768421873314, 19.583398684579187],[19.630518630346888, 19.402477540503362, 19.9955408905291, 20.33169939366425, 21.632985636378795, 20.797339201105185, 20.17476689594096, 22.630604583038263, 21.936984244825222, 22.598410846611916, 22.487633277488076, 23.455053223343935, 22.630764137139085, 22.671802252788243, 21.143306920942276, 21.647421643883085, 22.34905426930612, 22.843765905075962, 21.09644102481366, 21.91969442870254, 22.07130122041575, 22.2701504173164, 23.251728551132953, 23.160836241410088],[22.6598528295525, 22.045310109892135, 21.803411163448423, 20.26638689908541, 20.52609111729724, 21.339901832491673, 22.7281618687814, 22.25559549531517, 20.96095328477491, 20.49734083818953, 21.21382111024658, 21.546221316125862, 21.539708448626865, 20.81074684506147, 20.176121388973105, 21.425335105432364, 22.09963104449617, 23.36909877987381, 20.761428728345017, 20.61276385232336, 22.473611995215975, 23.061084836119598, 23.17968700233852, 22.87244585469001],[22.477744032323173, 21.317648609814352, 21.395251822758294, 21.443636105050278, 19.28299669954401, 20.124778929772773, 20.415201072033923, 20.6060451643377, 19.740844460881945, 19.557493198908837, 18.12216342052897, 19.341176069189405, 19.968798671745947, 19.90150868816776, 20.069586241533198, 22.101698072049068, 23.810902513345976, 24.366045281376906, 22.206839566694708, 20.888432720532833, 20.82300353823182, 20.858910112144525, 20.017240719838135, 18.136546105282854],[18.93655377136185, 18.998922246639786, 19.248509055116717, 18.918488664615445, 19.513648650952923, 19.31146545568376, 19.857021274656766, 19.82628335495489, 20.13404609532614, 19.819961254077285, 19.76787622334682, 19.220601085609427, 19.29850199957404, 19.28990212635239, 20.423708336437638, 19.286529204561095, 20.58929497102139, 19.936093165003964, 21.23965323573892, 20.890364275886114, 20.869966183095954, 21.163265765782555, 21.008590503951805, 21.596421879346792],[21.182822992876822, 19.924207843103204, 19.75962504036179, 19.366724820587198, 21.1569877021202, 20.434649361939268, 20.430299904058412, 20.875071702839673, 21.604434731626256, 22.607586683860823, 22.078019047662636, 21.797606344763288, 22.38224397642225, 22.741747394310135, 22.26050544796986, 23.00332759187626, 22.554896675366177, 22.149876338158613, 22.622740377999943, 21.95521568756438, 22.83036675442165, 21.905744975336972, 22.56073695044401, 21.994921441551906],[21.60878236846354, 20.309940532598823, 20.10486935802795, 19.99688544109821, 21.446579818539206, 21.039278129626528, 20.982083387600575, 21.86279937423718, 20.611892769486367, 19.828411263354162, 19.693801660927207, 21.25844595416036, 20.836843764272462, 21.905308887642555, 23.116385998922894, 23.666826501915843, 23.47859332075836, 20.05512129156321, 21.279777109077624, 20.538518822161084, 20.519862583843945, 20.507449200103025, 20.283871749645265, 20.699277103792245],[20.447218196188654, 19.55779476287816, 21.46161853831626, 22.06069222140074, 21.409015178759397, 20.495025351812558, 20.39604192431251, 19.71379916436219, 20.24364810837893, 20.236127435626717, 20.697999228966445, 21.264091878936867, 21.853480455035292, 22.929403073749405, 22.075026491175585, 21.64335423676254, 22.613238159401767, 22.324435289232007, 21.972341871721554, 22.051788823514435, 20.33237827163142, 20.403404563381276, 19.269388104170254, 21.08115841502091],[21.223945636768416, 21.828571934013823, 20.62721498457099, 21.425606484949757, 21.580239120367505, 21.65869092380826, 22.228981666708002, 20.329399253326397, 21.64550345589709, 23.645904190989405, 23.752811607074964, 24.51919258427555, 24.436317609031843, 23.467588025527547, 22.139956835500058, 23.279054241746266, 21.6408019752416, 22.828425388184126, 22.323575741345074, 23.135690992805912, 22.896856046688544, 22.336159298801153, 21.99925726543078, 21.06020735592278],[21.00625305570149, 21.029334259365893, 20.421702474317648, 20.156565348405966, 20.873601956138167, 20.244385687850663, 20.567218813846537, 21.123238947569963, 20.013540690519765, 20.514553774469086, 19.41489832686243, 19.566454852441698, 19.458193151258264, 20.62882321284952, 21.135115212816732, 21.05073733687493, 23.359442845903605, 20.78283345318094, 21.063967937909045, 21.340468384906558, 21.896878334383054, 21.342285225695935, 21.807867115496776, 21.00188117160672],[20.791409358559715, 21.455421760919627, 21.38008711634435, 20.742970094388973, 21.146871739195277, 20.1146231549714, 20.08412065592332, 19.779735027895622, 20.530698571012493, 20.94756656455555, 21.543727179364414, 21.98420942854935, 21.947524235697816, 21.856862206341454, 21.362730028342565, 22.8958318555541, 21.82979930229899, 20.42504662069728, 20.2927219042601, 21.700718533919037, 23.011193838849294, 22.039107022639026, 23.365904310738507, 24.496223009397916],[24.097645755112726, 21.304114833175397, 22.16779037330602, 21.1206905540761, 21.301200089762506, 21.46787086857632, 21.151494603332598, 20.77096389201823, 21.937530849824103, 22.092240595392582, 20.32862958123624, 21.52442890262432, 20.16681482982962, 21.18158181626208, 22.157605689707136, 24.143647749616733, 24.069176980141393, 22.865123990089945, 21.956656308677896, 21.633355569279985, 21.931577473021285, 21.36753416278097, 21.89266802894935, 21.57237814877017],[21.532509124569255, 22.601630459503042, 21.23852833875164, 21.50324791712581, 22.23362849094411, 21.634264006094448, 22.499460539828885, 22.93349906752485, 23.195712149298394, 24.188608564981028, 23.262345495923487, 23.94209783427131, 23.225783679765048, 22.664474215466406, 22.480434450285205, 23.75932420379831, 22.335934897293896, 23.852606628301064, 20.963547962502922, 20.257466797625753, 20.391401509832576, 22.126977469721062, 21.755414538505487, 21.77469089674393],[21.71200577875202, 21.956560267660276, 22.08651032620539, 22.453163126498136, 21.21736717742084, 22.189899436107087, 21.42606710614213, 21.02061914537746, 21.87729093308117, 21.92571507934656, 22.13997739088116, 22.00464370094526, 21.86893676144485, 20.958276001575058, 21.304746373407283, 21.76396411734195, 23.949810920885923, 23.139805180066286, 21.679144106499592, 22.867398691848074, 21.69602359844183, 20.615091973568855, 21.01320640941493, 21.092047980434554],[20.634401470685425, 19.989833840461557, 18.347536520761746, 18.118112589926096, 18.204217637615752, 20.49628624851113, 21.096450330642853, 20.643568507144032, 19.97864409263815, 21.56550933068716, 21.10725759537188, 20.2014408069033, 20.56161160871206, 21.435922778628306, 23.30999862939793, 24.136654468677488, 18.716699963808725, 20.18030356762369, 22.24566933452939, 23.330540565783597, 22.62238748966597, 21.768571009977183, 20.741270517954547, 20.870471529911036],[21.08291467868075, 20.62412290066398, 23.182744989068823, 23.039815024187163, 22.09380867200394, 22.808173010316324, 22.362050132475396, 21.47158905542454, 21.425280425057952, 21.43887472523915, 21.193806050827373, 22.334971608125528, 21.847418730549197, 19.360979589085563, 19.664908592668983, 22.576030567310575, 26.388308648190023, 25.66244197573366, 22.40596362763716, 21.724961613108974, 20.957804448631276, 20.63534375709953, 19.432681352807155, 20.017049462585597],[20.329511093739793, 20.65978978959069, 20.237621465186646, 21.1087062495141, 20.819661857613163, 21.477359231878836, 20.043524335369252, 20.3677956544462, 19.753688819556213, 19.85427148527376, 21.060027686872168, 20.02493482674599, 20.145860179175262, 21.510749703287498, 21.773138292784687, 23.188405734472486, 21.45106050036859, 21.07900233440112, 21.47785637539644, 21.98661058833354, 20.797877928419854, 21.15376789878749, 20.049935535922796, 20.033124104420423],[19.860268589686463, 20.1009518867257, 19.53204943077648, 21.253430844375597, 19.966205694881296, 19.480679742891148, 19.13500079194951, 19.474648089871934, 21.31750803550002, 20.357274323297343, 20.42503776386383, 20.77882941687898, 21.23943076082444, 21.292409504482677, 20.743453279857043, 21.931582994325286, 21.336765610726502, 22.93357118150442, 20.55210414411906, 21.83942310820464, 21.114053909589586, 20.493662432222262, 20.575387450830238, 21.391914605900425],[21.6305025444424, 21.962273091023434, 21.13827393418217, 21.563490494827143, 23.146925054439176, 23.710877302530303, 23.989934699297322, 23.337262798214535, 23.065753927530906, 21.657520686109965, 21.989782242766303, 21.740601869809144, 22.002538657473885, 21.94538863219807, 22.660776937916793, 23.77967644768385, 20.56793601799245, 22.495434336180054, 20.63754458915289, 21.580112617392718, 20.82562301241443, 22.320734149175046, 23.41286202063736, 22.60140702464887],[22.130853851965767, 21.357738190755683, 22.11572192370297, 22.11419589910861, 20.70700232854718, 19.62929599257614, 19.71716864993684, 20.063319256069448, 20.856907814579888, 21.56075721917149, 20.92829614385627, 22.079754848966537, 20.607348540008513, 19.076187771613956, 20.216881307441884, 18.70601513276918, 21.082326245649146, 22.503928782332178, 20.728799592285338, 21.245658423873913, 21.606915359415083, 22.015029097756766, 20.48872461492156, 21.01282392679785],[20.804953421574133, 20.18034044692321, 21.24383628706977, 20.62067195158332, 21.118224270876752, 20.718431140407855, 21.100390165437048, 22.13607475467379, 21.777321104395785, 21.697635396366024, 20.78330770486035, 19.60893523710442, 19.680129025664524, 19.29303911421384, 19.542078476933348, 19.991081370580257, 19.946693818411543, 21.069395689347985, 20.19321545823662, 22.42981198256534, 22.866523682585278, 22.348233848240252, 22.671399115933948, 23.03063990499125],[22.391868502552082, 22.14943840488951, 21.06939279799096, 21.575887350857514, 20.99819214722184, 20.86473444231649, 22.481367935709574, 20.3454761630646, 21.147842371426457, 22.00157970179525, 21.653474129384033, 20.23466350645103, 19.16229811051538, 18.838918896635715, 19.436924802937288, 22.86719346176256, 21.47261733867748, 22.036778209009913, 20.316683959866886, 22.069552729464306, 21.26006861582467, 20.409104780523908, 20.480019831760764, 19.97579246677979],[20.241742095627096, 20.33802603638627, 20.84386794854939, 20.029223873297077, 19.870049974684672, 20.35382531466156, 20.44902992495223, 20.75405361744476, 20.517937696924566, 20.603387448186254, 21.21459815606472, 21.157651201332953, 21.85865644707903, 21.79103308436881, 22.393994436111466, 21.974154836989175, 21.840006742048732, 21.747082092579976, 22.209617244629232, 22.981842988725326, 23.217487443153757, 21.987271915282953, 20.860480022680356, 20.70426808135609],[21.033516487682284, 22.84244009919339, 21.733507868761116, 22.56648759627806, 23.345174314280356, 23.21387033043627, 24.306833446331467, 24.21461630149558, 24.43843127522403, 23.253065262662858, 22.856595968053774, 19.761819230267932, 19.389339743397752, 18.806172560712024, 20.541108042949336, 23.18189856066055, 21.12313155633028, 22.002744141702525, 21.334257646601095, 19.812043123226328, 19.529007720833317, 19.580284942087847, 20.307783343686346, 20.387676732310833],[20.264338696215017, 20.63054088826507, 21.70099866037355, 21.13821969489506, 21.73637175941292, 21.548144190263827, 21.08462013710154, 22.468561805365923, 22.31389179172355, 23.26528041526904, 23.046186616184936, 22.85659426716591, 22.864144735139224, 22.529400109475215, 22.0624033978766, 23.618990271048478, 24.360516696808432, 22.678259937598014, 23.198405563401742, 25.416801073871277, 25.428941797810644, 25.530421849890185, 23.617571865669195, 21.757051007514253],[21.63779620277232, 22.55763794423912, 22.88812371771877, 21.957629735917134, 22.484497945078413, 21.72967415263647, 22.38622437220745, 22.802471448264516, 22.17943102965535, 22.44458476724053, 21.981731981685463, 20.55353793403335, 20.80240985779579, 20.82867082657594, 21.440426189612857, 21.29763547018375, 23.78700437162469, 19.214348990415637, 19.345659008795774, 19.21017103313687, 18.98948187612226, 18.521883440574555, 21.30714836652406, 21.465182594388715],[21.060622390779212, 20.585571244625946, 21.057440650313872, 21.2624887982392, 21.17427225039558, 19.632023655548295, 20.183347965983277, 21.227564222218003, 21.47923964035021, 20.87873585161756, 19.81952936611096, 18.927812547808475, 17.83898502300338, 18.747132063343415, 18.89760404023333, 19.437766931675913, 20.84148406473632, 20.121870249865363, 18.997587888415268, 19.17570718670933, 20.53923560622446, 20.48391485321636, 19.988951044907243, 20.76605639621254],[20.65995152369059, 20.372419102047754, 20.27816691076058, 19.34902107951933, 20.63304773273128, 20.96499048133952, 18.85373805429073, 20.363100190239965, 20.210866984945774, 19.524913864666868, 20.765573355964634, 20.925585342347663, 21.37582642475951, 22.76121824710737, 24.1345653355666, 24.933557072270784, 24.60794586346626, 23.00111842099414, 21.92059448078257, 21.994923749150885, 21.977251306979916, 19.4450802536646, 19.961092355419645, 20.56602973592187],[20.56795308196697, 20.426241377007624, 21.600803703583495, 22.934439765908916, 23.103483831241437, 21.647386618140484, 20.7037413126321, 20.207776611721144, 21.18092568686936, 20.211719728705763, 21.712290545941546, 22.605343330045187, 22.59728755034265, 22.35037884660125, 21.359877107087744, 19.815297381074714, 22.900586327010018, 24.02419635505644, 22.83664113091584, 22.20106548112186, 21.458651890414036, 20.001042931862663, 19.191600874769804, 21.345334419905235],[21.116941676620634, 20.97460846584389, 20.834971003865263, 21.885082324071046, 21.316538144763314, 20.819680325941587, 19.392664829997088, 20.165044064641734, 20.34333421672849, 20.2160635502603, 21.012518428861426, 21.509515118380847, 21.688030579788848, 21.960035263163427, 22.096304869608428, 21.014532078364645, 20.799734812581004, 22.43952126332881, 23.37134865517528, 22.734726065814343, 22.137287953996406, 23.58008812384461, 24.690870828866547, 25.324214978083564],[24.850595956831203, 23.306222463775143, 23.968849690577223, 23.557662303810353, 22.912800203305885, 23.042331789058416, 23.249984201686413, 23.476325508726998, 21.42930981840113, 21.094403042515786, 22.10623432196453, 22.41810491841154, 22.143201576829945, 21.911007798039694, 22.774374798232547, 24.480098560607612, 22.418417349514264, 24.45141193387248, 21.3589185050009, 20.390743624707188, 20.992709542904826, 22.6191006534022, 22.955498142135752, 21.907489075246456],[21.55166118835957, 20.93698123730681, 20.204131372419596, 20.945255755691925, 20.265662439172715, 19.852198122445255, 20.924539734073655, 21.039210944154103, 20.258126278913696, 20.076467437836907, 19.797617041714222, 19.36068595599358, 21.03119164565964, 22.959425631675444, 24.01304102336588, 22.88916150054566, 22.703832677238452, 24.15764342461903, 22.544061680636872, 22.867193714743365, 21.08219183152049, 20.76561831622645, 19.47172264049211, 19.584682172659],[20.009830040388824, 20.538308189416174, 19.627381853644085, 20.152459367003722, 20.59332361181898, 21.133073237355642, 22.005989476333554, 22.145949314551892, 21.979781274727255, 22.408868838628614, 21.881261390988403, 21.82404681659642, 22.943454969245508, 20.80155671821244, 20.543632080285406, 19.520873766687846, 20.964239407971608, 20.890704696599965, 21.29766637312333, 20.939844200530086, 20.916173671681875, 22.59283416361857, 22.341177045822057, 22.296545716601965],[21.717001457735222, 19.326778184039263, 22.063227615633814, 22.433418915856013, 22.05919934757699, 21.285258838037983, 20.414086698383905, 20.757201810040186, 21.15726051980439, 21.93848159464295, 21.866304549327893, 20.650280565089744, 21.050371277950926, 21.468378577836162, 22.0542384218522, 18.84561221157508, 21.779677866900798, 20.600155356437355, 22.588274611873775, 20.80314947219538, 21.390942259354325, 21.3309701948648, 20.958239748320853, 21.168919661451337],[20.919931754088392, 21.822357244385426, 22.330711674829924, 22.266162574143, 24.010298636968884, 22.866796856674814, 22.24286396507374, 21.01718591191113, 21.358263212432927, 22.363483606356446, 22.083721960104818, 22.716606311007354, 22.86549419935063, 23.351127609416128, 23.995493125552198, 24.239403583506018, 23.32337301651188, 19.753534733568628, 20.64875608771483, 19.49972241021221, 18.912574082170995, 18.819730488175686, 19.574697922250817, 18.325669057863525],[18.471879138540267, 16.222711261524363, 18.669500904860833, 19.382313089789104, 19.18231700532715, 18.432667199647646, 18.665065142033153, 20.211531318340366, 19.02310774081605, 19.69925937270307, 19.052201803995292, 19.699387854316605, 18.579794168909032, 18.273722317885188, 18.7277642209112, 14.83222562915002, 17.86788389038709, 18.719638053219818, 18.793408785007166, 19.412637555176207, 20.664033037722415, 21.578062175656655, 21.36825291179989, 20.07845087200453],[19.982143785319508, 20.70594393247885, 18.874522630403977, 18.841720944225944, 18.582215670681695, 19.31644629258936, 19.040370812051396, 19.210613104807035, 19.233991764416235, 19.133876540107426, 19.155114501830152, 19.12670072431581, 19.130575149181862, 18.721361125028157, 19.181264341209666, 22.072492991644168, 20.316282983986238, 16.80412628483997, 20.961493873207196, 20.18568256119102, 20.715752855843217, 21.54740170422534, 21.480289821899405, 20.651620772723287],[20.590208164550862, 19.907097121411297, 21.33806797545784, 23.044027508887908, 22.88253939494885, 23.162979615251526, 22.757629608578466, 23.577130673924245, 23.07459723857988, 23.383819840331654, 23.155023376184108, 22.052341524510922, 20.96980135082413, 20.54982309177482, 19.002508313502805, 19.615952252964494, 21.215793233288938, 24.537691902562003, 21.503994849540067, 21.22904269307195, 21.437847807086285, 22.698287030802714, 21.165048144471694, 20.713015413471794],[20.647809021813636, 20.873728224344855, 21.321022381227316, 21.509601583964667, 20.12784352806397, 19.732444439870903, 19.67370636587745, 20.04970519457847, 20.548793874357735, 20.89937489530203, 20.66632895825279, 20.646860460480344, 20.842151286148013, 22.121401408220446, 22.802439784680395, 22.26741057078662, 23.552242751851832, 24.25089545281446, 21.399392731297333, 21.82896666702952, 21.1447840629707, 19.95556262085548, 20.62200004904527, 21.61183038526698],[21.37458304421166, 21.671621890261175, 22.00719296962336, 21.74855156042197, 20.648171494217053, 20.176017974659796, 20.301376534597132, 21.571355901835616, 21.68057546195859, 20.52650626982276, 20.45168107983772, 21.879699134470247, 22.911876956420375, 23.465597102033104, 22.325374329857897, 23.807280688549945, 21.083685174448913, 23.94648174713128, 22.823120868462233, 23.168661654111478, 23.08995866407004, 22.57405857523741, 21.853631644729866, 21.581485333226325]])

    print("electricity prices array")
    electricity_prices
    return (electricity_prices,)


@app.cell
def _(electricity_prices, np):
    np.shape(electricity_prices)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (a)
    """)
    return


@app.cell
def _(electricity_prices, np):
    def mu(i):
        # Selecting the i-th column and calculating the mean
        return np.mean(electricity_prices[:, i])
    return (mu,)


@app.cell
def _(mo):
    mo.md(r"""
    # part (b)
    """)
    return


@app.cell
def _(electricity_prices, mu, np):
    def mycov(i, j):
        # Returning the mean of the product of deviations for hours i and j
        return np.mean((electricity_prices[:, i] - mu(i)) * (electricity_prices[:, j] - mu(j)))
    return (mycov,)


@app.cell
def _(mo):
    mo.md(r"""
    # part (c)
    """)
    return


@app.cell
def _(mycov, np):
    # Initializing a 24x24 matrix of zeros
    Sigma = np.zeros((24, 24))

    # Filling the matrix using a double loop
    for i in range(24):
        for j in range(24):
            Sigma[i, j] = mycov(i, j)
    return Sigma, i


@app.cell
def _(mo):
    mo.md(r"""
    # part(d)
    """)
    return


@app.cell
def _(Sigma, plt):
    import seaborn as sns

    plt.figure(figsize=(10, 8))
    # Plotting the heatmap
    sns.heatmap(Sigma, cmap='viridis', annot=False)
    plt.title("Covariance Matrix of Electricity Prices")
    plt.xlabel("Hour j")
    plt.ylabel("Hour i")
    plt.show()
    return (sns,)


@app.cell
def _(mo):
    mo.md(r"""
    ### 1. Symmetry Across the Diagonal (y=x)

    * **Observation:** The heatmap is perfectly symmetrical; the top-right triangle mirrors the bottom-left triangle.
    * **Classification:** **Dataset-Independent**
    * **Reason:** This is a fundamental mathematical property. Covariance is commutative, meaning \text{Cov}(X_i, X_j) = \text{Cov}(X_j, X_i). This symmetry exists for every covariance matrix.

    ### 2. High Values Along the Main Diagonal

    * **Observation:** The main diagonal contains strictly positive values and is generally brighter than the off-diagonal regions.
    * **Classification:** **Dataset-Independent (Mathematical)** / **Dataset-Dependent (Structure)**
    * **Reason:** Mathematically, the diagonal represents variance, which must be non-negative. Structurally, time-series data typically shows higher values on the diagonal because correlation naturally decays as the time lag between two points increases.

    ### 3. The "Bright Block" in Late Afternoon (Hours 15–18)

    * **Observation:** A distinct block of bright colors (high variance) appears along the diagonal between indices 15 and 18 (3 PM – 6 PM).
    * **Classification:** **Dataset-Dependent**
    * **Reason:** This reflects the specific nature of electricity markets. It indicates higher price volatility during "peak demand" hours when consumers return home. This pattern is specific to this type of data and would not appear in steady-state datasets.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (e)
    """)
    return


@app.cell
def _(electricity_prices, np, plt, sns):
    # 1. Shift the entire dataset down by 1 day (Lag of 1)
    #    prices_prev[i] will now contain the data from day i-1
    prices_prev = np.roll(electricity_prices, 1, axis=0)

    # 2. Mask the invalid row
    #    When rolling, the last day wraps to the top (index 0). 
    #    This data is incorrect (Day 60 is not the "previous day" for Day 1).
    #    We exclude row 0 from both arrays to ensure valid comparisons.
    valid_rows = slice(1, None) # Equivalent to [1:]

    # 3. Creating the deviation matrices (Centering the data)
    #    Subtracting the column means to get residuals
    X = electricity_prices[valid_rows] - np.mean(electricity_prices[valid_rows], axis=0)
    Y = prices_prev[valid_rows]        - np.mean(prices_prev[valid_rows], axis=0)

    # 4. Computing the Covariance Matrix using Matrix Multiplication
    #    Cov(X, Y) = E[X * Y]. With centered matrices, this is (X.T @ Y) / N
    N = X.shape[0]
    Sigma_lag = (X.T @ Y) / N

    # 5. Plotting the Heatmap
    plt.figure(figsize=(10, 8))
    sns.heatmap(Sigma_lag, cmap='viridis', annot=False)
    plt.title("Lagged Covariance (Current Day i vs Previous Day j)")
    plt.xlabel("Hour j (Previous Day)")
    plt.ylabel("Hour i (Current Day)")
    plt.show()
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Q. Does this tell you anything interesting?**

    Yes, the lagged covariance heatmap reveals the nature of the system's "memory" and continuity:

    1. **Temporal Continuity at the Boundary:** The most prominent feature is a high covariance value in the top-right corner (corresponding to Hour 0 of the current day vs. Hour 23 of the previous day). This indicates strong temporal continuity: electricity prices do not "reset" at midnight. The price at 11:59 PM yesterday is the strongest predictor for the price at 12:00 AM today, confirming that the physical constraints and market conditions persist seamlessly across the day boundary.
    2. **Lack of 24-Hour Persistence:** Unlike the standard covariance matrix in Part (d), the main diagonal (comparing Hour i today vs. Hour i yesterday) is not a dominant feature. This suggests that while average prices follow a 24-hour cycle, anomalies in prices do not. A random price spike at 2 PM today does not strongly guarantee a similar random spike at 2 PM tomorrow. The system's memory for random fluctuations is relatively short-term and fades significantly over a 24-hour lag.
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # Question 3
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (a)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    ### a) Express the optimisation problem as a quadratic program

    To express the problem in the standard quadratic programming form:

    $$
    f(\underline{x}) = \min_{\underline{x}} \underline{x}^T Q \underline{x} + \underline{c}^T \underline{x}
    $$

    $$
    \text{subject to } h(\underline{x}) = 0
    $$

    We identify the corresponding terms from the given objective function:

    $$
    f(\underline{x}) = \text{monetary cost}(\underline{x}) + \gamma \sum_{i=1}^{24} x_i^2
    $$

    **1. Linear Term ($\underline{c}$):**
    The monetary cost is the sum of the hourly price times the quantity. In vector notation, this is the dot product of the price vector $\underline{p}$ and the quantity vector $\underline{x}$.

    $$
    \text{monetary cost} = \underline{p}^T \underline{x}
    $$

    Comparing this to the linear term $\underline{c}^T \underline{x}$ in the standard form, we find:

    $$
    \underline{c} = \underline{p}
    $$

    **2. Quadratic Term ($Q$):**
    The battery degradation term is $\gamma \sum x_i^2$. In matrix notation, the sum of squares is $\underline{x}^T I \underline{x}$. Scaling this by $\gamma$:

    $$
    \gamma \sum_{i=1}^{24} x_i^2 = \gamma (\underline{x}^T I \underline{x}) = \underline{x}^T (\gamma I) \underline{x}
    $$

    Comparing this to the quadratic term $\underline{x}^T Q \underline{x}$, we find:

    $$
    Q = \gamma I_{24}
    $$

    *(where $I_{24}$ is the $24 \times 24$ identity matrix)*

    **3. Constraint Function ($h(\underline{x})$):**
    The constraint is that the total electricity bought must equal 100. Using the vector of ones, $\underline{1}$ (where $\underline{1} \in \mathbb{R}^{24}$), this sum is written as the dot product $\underline{1}^T \underline{x}$.

    $$
    \sum_{i=1}^{24} x_i = 100 \implies \underline{1}^T \underline{x} = 100
    $$

    Rearranging this to match the form $h(\underline{x}) = 0$:

    $$
    h(\underline{x}) = \underline{1}^T \underline{x} - 100
    $$

    **Final Answer:**

    * **Matrix $Q$**: $\gamma I_{24}$
    * **Vector $\underline{c}$**: $\underline{p}$
    * **Function $h(\underline{x})$**: $\underline{1}^T \underline{x} - 100$
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part (b)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Pen and Paper Gradients:** We need to find the gradients of $f(\underline{x})$ and $h(\underline{x})$ with respect to the vector $\underline{x}$. Gradient of the Objective Function $\nabla f(\underline{x})$:From Part (a), we established that $f(\underline{x}) = \underline{x}^T Q \underline{x} + \underline{c}^T \underline{x}$. Using standard matrix calculus rules: The gradient of a linear term $\underline{c}^T \underline{x}$ is $\underline{c}$.The gradient of a quadratic term $\underline{x}^T Q \underline{x}$ is $(Q + Q^T)\underline{x}$.Since $Q = \gamma I$ is a symmetric matrix ($Q = Q^T$), the gradient simplifies to $2Q\underline{x}$.Substituting back our specific matrices ($Q = \gamma I$ and $\underline{c} = \underline{p}$):$$\nabla f(\underline{x}) = 2\gamma I \underline{x} + \underline{p} = 2\gamma \underline{x} + \underline{p}$$Gradient of the Constraint Function $\nabla h(\underline{x})$:From Part (a), $h(\underline{x}) = \underline{1}^T \underline{x} - 100$.The gradient of $\underline{1}^T \underline{x}$ is simply the vector of ones, $\underline{1}$. The constant $-100$ disappears during differentiation.$$\nabla h(\underline{x}) = \underline{1}$$
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    # part(c)
    """)
    return


@app.cell
def _(electricity_prices, np):

    dim = 24
    gamma = 0.5           # Added default value for Part (c) verification
    p = np.mean(electricity_prices, axis=0)  # Price vector from Part (a)


    I = np.eye(dim)          # Identity matrix 24x24
    ones = np.ones((dim, 1)) # Column vector of ones 24x1


    # Top half: [2*gamma*I, ones]
    # 2*gamma*I is (24,24). ones is (24,1).
    top_row = np.hstack([2 * gamma * I, ones])

    # Bottom half: [ones.T, 0]
    # ones.T is (1,24). [[0]] is (1,1).
    bottom_row = np.hstack([ones.T, [[0]]]) 

    # Stack top and bottom
    A_matrix = np.vstack([top_row, bottom_row])


    # b = [-p, 100]
    # -p is (24,). 100 is a scalar.
    b_vector = np.concatenate([-p, [100]])

    print("Matrix A shape:", A_matrix.shape) 
    print("Vector b shape:", b_vector.shape) 
    return dim, p


@app.cell
def _(mo):
    mo.md(r"""
    # part(d)
    """)
    return


@app.cell
def _(dim, gamma_slider, mo, np, p, plt):

    g_val = gamma_slider.value
    din = 24

    # Re-build matrix A for this specific gamma value.
    _I = np.eye(din)
    _ones = np.ones((din, 1))

    # Top: [2*g*I, 1]  |  Bottom: [1.T, 0]
    _top = np.hstack([2 * g_val * _I, _ones])
    _bot = np.hstack([_ones.T, [[0]]])
    A_dynamic = np.vstack([_top, _bot])

    # Build vector b (using p from previous parts)
    b_dynamic = np.concatenate([-p, [100]])

    # Solving
    solution_dynamic = np.linalg.solve(A_dynamic, b_dynamic)
    x_dynamic = solution_dynamic[:dim]


    fig_d, ax_d = plt.subplots(figsize=(10, 6))

    # Plotting bars
    ax_d.bar(range(24), x_dynamic, color='skyblue', label='Electricity Bought')
    ax_d.set_title(f"Optimal Strategy for γ = {g_val:.2f}")
    ax_d.set_xlabel("Hour")
    ax_d.set_ylabel("kWh")
    ax_d.axhline(0, color='black', linewidth=0.8)
    ax_d.grid(True, alpha=0.3)

    # Ploting price overlay
    ax_p = ax_d.twinx()
    ax_p.plot(range(24), p, color='orange', linestyle='--', label='Price')
    ax_p.set_ylabel('Price (p)')

    # DisplayingPlot and Text
    mo.vstack([
        fig_d,
        mo.md(f"**Total Bought:** {np.sum(x_dynamic):.2f} kWh")
    ])
    return g_val, x_dynamic


@app.cell
def _(mo):
    gamma_slider = mo.ui.slider(start=0.01, stop=1.0, step=0.01, value=0.1, label="Gamma (γ)")

    gamma_slider
    return (gamma_slider,)


@app.cell
def _(mo):
    mo.md(r"""
    # part(e)
    """)
    return


@app.cell
def _(g_val, p, plt, x_dynamic):

    fig_e, ax_e = plt.subplots(figsize=(8, 6))

    # Scatter: x-axis = Price, y-axis = Electricity Bought
    ax_e.scatter(p, x_dynamic, color='purple', alpha=0.7, edgecolors='k', s=80)

    ax_e.set_title(f"Electricity Bought vs. Price (γ = {g_val:.2f})")
    ax_e.set_xlabel("Mean Electricity Price (pence/kWh)")
    ax_e.set_ylabel("Electricity Bought (kWh)")
    ax_e.axhline(0, color='black', linewidth=0.8, linestyle='--') # Zero line 
    ax_e.grid(True, alpha=0.3)

    ax_e.text(0.05, 0.95, "Buying (x > 0)", transform=ax_e.transAxes, color='green', fontweight='bold')
    ax_e.text(0.05, 0.05, "Selling (x < 0)", transform=ax_e.transAxes, color='red', fontweight='bold')

    # Show the plot
    fig_e
    return


@app.cell
def _(mo):
    mo.md(r"""
    # Bonus: Gradient Descent on the Lagrangian
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    1. The Mathematical Setup I am are trying to find the saddle point of the Lagrangian $\mathcal{L}$:$$\min_x \max_\lambda \mathcal{L}(x, \lambda) = \underbrace{p^T x + \gamma x^T x}_{f(x)} + \lambda (\underbrace{\mathbf{1}^T x - 100}_{h(x)})$$
    2. Descend on $x$ (minimize objective): $$x \leftarrow x - \eta \nabla_x \mathcal{L}$$
    3. Ascend on $\lambda$ (maximize constraint violation penalty): $$\lambda \leftarrow \lambda + \eta \nabla_\lambda \mathcal{L}$$
    """)
    return


@app.cell
def _(mo, np, p, plt):
    #Gradient Descent Settings
    learning_rate = 0.001
    iterations = 1000
    gamma_val = 0.1 

    # Initializing variables randomly
    x_gd = np.random.randn(24)
    lambda_gd = 0.0  

    # History for plotting
    history_constraint = []
    history_obj = []

    for o in range(iterations):
        # Calculating Gradients
        # grad_x L = p + 2*gamma*x + lambda*1
        grad_x = p + 2 * gamma_val * x_gd + lambda_gd * np.ones(24)

        # grad_lambda L = sum(x) - 100
        grad_lambda = np.sum(x_gd) - 100

        # Updating Weights
        # Gradient DESCENT on x (minimize cost)
        x_gd = x_gd - learning_rate * grad_x

        # Gradient ASCENT on lambda (maximize/enforce constraint)
        lambda_gd = lambda_gd + learning_rate * grad_lambda

        # Log data
        history_constraint.append(grad_lambda) # This is the error (sum(x) - 100)

    # Plotting the Failure
    fig_bonus, ax_bonus = plt.subplots(figsize=(10, 5))
    ax_bonus.plot(history_constraint, label='Constraint Violation (sum(x) - 100)', color='red')
    ax_bonus.set_title("Why Gradient Descent Fails: Oscillating Constraint Violation")
    ax_bonus.set_xlabel("Iteration")
    ax_bonus.set_ylabel("Error")
    ax_bonus.grid(True, alpha=0.3)
    ax_bonus.legend()

    mo.vstack([
        mo.md("### Bonus: Gradient Descent Attempt"),
        fig_bonus,
        mo.md(f"**Final Constraint Error:** {history_constraint[-1]:.4f} (Should be 0)")
    ])
    return


@app.cell
def _(mo):
    mo.md(r"""
    Solving for the Lagrangian requires finding a saddle point (a minimum with respect to $x$ and a maximum with respect to $\lambda$), not a simple minimum. Standard Gradient Descent is designed to roll downhill to a local minimum. When we update $x$ and $\lambda$ simultaneously, they often work against each other. The $x$ update tries to lower the cost (often by breaking the constraint), and the $\lambda$ update tries to pull it back to satisfy the constraint. This push-and-pull results in numerical oscillations (spiralling around the solution) rather than convergence. Unless the learning rate is tuned perfectly (or a more advanced dampening method is used), the system is ill-conditioned and unstable compared to the direct matrix solution we used in Part C
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # Question 4
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part (A): Maximum predator population for prey growth
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    We look at the rate of change for the prey population:$$\dot{N}(t) = \underbrace{aN(t)}_{\text{births}} - \underbrace{bN(t)P(t)}_{\text{deaths}}$$We want the condition where prey births outstrip deaths:$$\text{Births} > \text{Deaths}$$$$aN(t) > bN(t)P(t)$$Assuming $N(t) > 0$, we can divide both sides by $N(t)$:$$a > bP(t)$$$$P(t) < \frac{a}{b}$$
    **The maximum predator population is $a/b$. If the predator population exceeds this threshold, the prey population will start to decline.**
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(b): Conditions for shrinking predator population
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    We look at the rate of change for the predator population:$$\dot{P}(t) = cN(t)P(t) - dP(t)$$The population is shrinking when the rate of change is negative ($\dot{P}(t) < 0$):$$cN(t)P(t) - dP(t) < 0$$Factor out $P(t)$:$$P(t) [ cN(t) - d ] < 0$$Since $P(t) > 0$, the term in the brackets must be negative:$$cN(t) - d < 0$$$$cN(t) < d$$$$N(t) < \frac{d}{c}$$

    **The predator population shrinks when the prey population $N(t)$ is less than $d/c$. (This means there isn't enough food to sustain the current predator population).**
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(c): Prey dynamics without predators ($P=0$)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    If there are no predators ($P(0) = 0$), the predator term $-bN(t)P(t)$ becomes zero. The equation for prey becomes:$$\dot {N}(t) = aN(t)$$This is the standard equation for exponential growth. The solution is $N(t) = N(0)e^{at}$.

    **In the absence of predators, the prey population will grow exponentially and indefinitely over time. The growth rate increases as the population gets larger.**

    **Q. Is this reasonable?**

    No, this is not reasonable for long periods. In reality, an ecosystem has finite resources (food, space, water). A population cannot grow to infinity. It would eventually reach a carrying capacity imposed by the environment, where growth would slow down and stop (logistic growth).
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(d)
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    **1.** Finding the Fixed PointsWe are given the modified prey dynamics equation (without predators):$$\dot{N}(t) = aN(t) \left( 1 - \frac{N(t)}{K} \right)$$To find the fixed points, we look for population sizes where the rate of change is zero ($\dot{N}(t) = 0$):$$aN(t) \left( 1 - \frac{N(t)}{K} \right) = 0$$Since the growth rate $a$ is non-zero, there are two solutions:

     a.  $N(t) = 0$ (The population is extinct).

     b.  $1 - \frac{N(t)}{K} = 0 \implies \frac{N(t)}{K} = 1 \implies$ $N(t) = K$.

     **So, the fixed points are $0$ and $K$**

     **2.** Interpreting the Parameter $K$. The parameter $K$ represents the carrying capacity of the environment.

     a. It is the maximum population size that the environment can sustain indefinitely, given limited resources (such as food, water, and space).

     b. In this logistic growth model:  **If** the population is below $K$ ($N < K$), the growth term is positive, and the population increases.  **If** the population exceeds $K$ ($N > K$), the growth term becomes negative, and the population shrinks back towards $K$.
    """)
    return


@app.cell(hide_code=True)
def _(np):
    data = np.array([0.0,0.8253705906272355,0.8202189457560609,0.01,1.2512593336967723,0.8804750446630152,0.02,1.0744696556474873,1.1951921572383182,0.03,1.1459487035702027,1.367022776863449,0.04,0.7406895127926447,0.8201930700228012,0.05,0.8032848443220044,0.8020943063852652,0.06,1.0423448720147894,0.9964271033305258,0.07,0.8669728720976302,0.9441559192867863,0.08,1.2485960741022775,1.5041279662393712,0.09,1.076411156475735,1.1868935239104308,0.1,1.0913514213811686,0.9337625654623029,0.11,1.221170545353793,1.1610562276254386,0.12,1.375609475040752,0.655991292042743,0.13,0.8456932534642474,0.8506565612423291,0.14,1.258988003318481,1.1437659353110625,0.15,1.0879326273705237,1.0144919079948402,0.16,1.2153693242032464,0.7890236302137076,0.17,1.3345684906603732,0.845424978575131,0.18,1.3137461562592339,0.8732260333351302,0.19,1.428277636494295,0.7061086355004339,0.2,1.5634075717811937,1.0395408458276172,0.21,1.3657438416115804,0.7780988598914812,0.22,1.4701608691245298,0.5437392240834374,0.23,1.5807693768769069,0.9623069207018562,0.24,1.3611883347347324,0.9821342334236914,0.25,1.4457543056328748,0.8463710162668501,0.26,1.513272170291705,0.45113076913045824,0.27,1.5756694495348156,0.7030469767603075,0.28,1.7020605367742399,0.5729183278716372,0.29,1.5481502977674486,1.0163316238356903,0.3,1.5900510345416954,1.1060720781878284,0.31,1.0176651770385163,0.8433681203723178,0.32,1.4750305241179156,0.8633310778531771,0.33,1.7081457157589555,0.7183105081906727,0.34,1.4545873580628512,0.7161981206236734,0.35,1.6425374522443608,0.8451669712966948,0.36,1.2322095928749066,0.7277924775899506,0.37,1.7442236802696258,0.9444102056298844,0.38,1.6192842786863628,0.521116022711692,0.39,1.6720580362341673,0.9848395057495227,0.4,1.4406205509598402,0.6515616676522077,0.41,1.8104217696306768,0.8706134751492154,0.42,1.7459932031571956,0.3144483218946911,0.43,1.5767615322608257,0.9555716460005269,0.44,1.9883647007071132,0.6516479213791484,0.45,2.0759946358397485,0.3587906462339842,0.46,1.7891540869010643,0.7250806159755979,0.47,2.0063940831177627,0.6774129096864877,0.48,2.351207088675081,1.0236509460596814,0.49,2.0023608091194363,0.667932869715822,0.5,1.7307173612759736,0.501168623020454,0.51,2.039375219294437,0.8649538899170633,0.52,1.7940703111564535,0.7907339894164709,0.53,1.8975440140190953,1.0397029814910477,0.54,2.1292376751093736,0.5619762412364976,0.55,2.166703207978072,1.0916421814821662,0.56,2.355302913074924,0.6074458043963602,0.57,2.5081045622410763,0.8992398806684452,0.58,2.4655037772173114,0.7100132147171605,0.59,2.3719926113777676,0.9543949865179597,0.6,2.415344505684415,0.7608814073283383,0.61,2.4519116927962483,0.1518977986382677,0.62,2.508686203478478,0.8777536036963025,0.63,2.44182495142244,0.3823790716156763,0.64,2.0953200090463766,0.756025640199692,0.65,2.371777573831583,0.94151456106178,0.66,2.7044765777810214,0.26000283454630163,0.67,2.7806801024780663,0.4655487715362591,0.68,2.8505994601079347,0.8731015661504052,0.69,2.118623542208117,0.8223683742763328,0.7,2.621650428862529,0.9131445555351273,0.71,2.582402132244429,0.8946045465353925,0.72,2.483455037038926,1.0804949294453423,0.73,2.7572845455280195,0.8781018922046983,0.74,3.037439215513899,0.7605951160308121,0.75,2.8142606623509803,0.5718944238558733,0.76,2.882627355854355,0.8423085744922739,0.77,2.6919362643369737,0.6537816111465011,0.78,2.9753950748656632,0.719193181569344,0.79,3.0201614018936467,0.9311606867703295,0.8,2.8378595179797887,1.3062887919414568,0.81,3.1485048063642074,0.9583632891106408,0.82,2.8551434774933604,0.5686122074721297,0.83,2.7217156460548937,0.7916533287783812,0.84,3.0066794823419003,0.7229932623718125,0.85,3.2991929070971246,0.7708487675653453,0.86,3.2554299528848207,0.8826191739938739,0.87,3.350693449957946,0.6764175410308613,0.88,3.1485729050577214,1.0557116508974644,0.89,2.940802542097215,1.3186954675236489,0.9,3.4216160463483165,1.0655201490268742,0.91,3.6496661453401464,0.9868288580985981,0.92,3.7735996493671515,0.6236263561003901,0.93,3.6779253144380375,1.0522258249795788,0.94,3.5548241659620192,0.9970048790818771,0.95,3.7205692095695384,0.9363674379234116,0.96,3.7191478156316724,1.180710154914114,0.97,3.8265182016340824,1.0614030299339015,0.98,3.7654174965718243,1.0809638766740044,0.99,3.8876378228393293,0.8805970655863106,1.0,3.2517154072100416,1.061573048050119,1.01,3.802494373562257,1.294143355228126,1.02,3.7380941484585244,1.4174672336551806,1.03,4.10419094949246,1.2897930568291085,1.04,3.8610475178369366,1.3813135272991088,1.05,3.90655891410061,0.9567145819063867,1.06,4.116352164311322,0.925552053189032,1.07,3.785241723237567,1.2679570691628406,1.08,3.7384576832046372,1.123604703705015,1.09,4.0399392139651935,1.4784111890087166,1.1,3.9920674027997056,1.280541928801772,1.11,3.761001739376474,1.2998915551104322,1.12,4.179086933311257,1.3027816505973397,1.13,3.6938897559969477,1.0357324781825141,1.14,3.865997460139013,1.486026073023141,1.15,4.126991087506379,1.3366818924274007,1.16,4.44028835829517,1.302071847268636,1.17,3.8948317213944947,1.2719272880533414,1.18,3.9660739831477807,1.5269101959997764,1.19,3.96417055783056,1.394160532189975,1.2,3.951741379634038,1.3393730340995145,1.21,4.130423700118754,1.9225294077584258,1.22,4.011153295523203,1.3789558003503761,1.23,4.127114937276425,1.8158897289687976,1.24,3.8576560383714424,1.7175629765004268,1.25,4.028234337453515,1.5799859944613261,1.26,4.245641116516499,2.004985800788266,1.27,4.076117409545003,1.9105867315709613,1.28,4.00400301175127,1.6556424770499498,1.29,3.7823342308538295,1.6324364627833166,1.3,3.764996086913561,2.1247393370528167,1.31,3.8659291830929945,1.8784350833246848,1.32,3.5968682859804626,2.188643095611304,1.33,3.903770860376655,2.111913062251637,1.34,3.507049053282115,2.2999758180173573,1.35,3.602888291346972,1.9809206761801883,1.36,3.2503668252016253,2.179376027266853,1.37,3.2415726746318536,1.8744057617442926,1.38,3.298615446389396,2.2443323580979375,1.39,3.3496050279320624,2.746262416501709,1.4,3.5523062176565197,2.375882352440953,1.41,3.356074635593233,2.4731998893925824,1.42,3.124247954671158,2.109360093874913,1.43,2.8411526022537363,2.690627874902785,1.44,3.051096033186018,2.492938663675386,1.45,3.07624609786167,2.108214342756693,1.46,2.9047865239434705,2.417236745149951,1.47,3.0559491404706045,2.46153937847029,1.48,2.75546186847479,2.638613254380666,1.49,2.965551628445072,2.5230261567288754,1.5,2.6184637344935116,2.840825402995792,1.51,2.4865336280057253,2.5942899295575756,1.52,2.863511151956073,2.7074844267779614,1.53,2.471359518548605,2.414562391126137,1.54,2.3413930374187584,2.520526907526854,1.55,2.5956239512418406,2.58576815527428,1.56,1.899129933067544,2.6652152687682444,1.57,2.736308054048812,2.6743762721684883,1.58,2.1619347853076345,2.630687460093294,1.59,2.3017624464496675,2.6023090062623413,1.6,2.1668332403287187,2.6066345070118317,1.61,2.2313821910680023,2.897725782442959,1.62,2.1627966876233238,2.7052575832788057,1.63,2.291740372742384,2.7043721875560878,1.64,2.2921606630342897,2.912388404601338,1.65,1.8887921812254713,2.892475740447905,1.66,1.646931925264305,2.7376866240869235,1.67,1.4503187834012772,2.881901979381492,1.68,1.5897447161567788,2.583759618163891,1.69,1.7731465796823263,3.0635672260641806,1.7,1.6523016738776406,2.8226253701502704,1.71,1.1990886777888394,3.04477240864657,1.72,1.3029898833844376,2.7631376192260317,1.73,1.4537400757641468,2.3985093131095767,1.74,1.889872090711736,2.4667584870661416,1.75,1.1574287858045684,2.583915356682998,1.76,1.6432197897921526,2.4644503111419134,1.77,1.516895712695242,2.7214622407673947,1.78,1.4640042795400443,2.404350028043953,1.79,1.1849935631094908,2.4395917381343404,1.8,1.1751195534749899,2.4442755167909045,1.81,1.2550483535239274,2.3807114738944923,1.82,1.3285483741775175,2.525899488020486,1.83,0.9065771882406435,2.276068167668241,1.84,1.3721556067161755,2.908165170703417,1.85,1.401946604385084,2.212138315037437,1.86,1.332569785408628,2.588678931149495,1.87,0.9665648235610689,2.6303059297285527,1.88,1.45424514734988,2.5831852858705266,1.89,0.8508406820771799,2.419095330210788,1.9,0.9782665372929478,2.421449454871508,1.91,1.2271608150569089,2.1249827276443902,1.92,1.3009739216215368,2.1044471944866685,1.93,1.3878758883141558,2.274632068316371,1.94,1.0192196455894986,2.3631181318447405,1.95,0.7460924551769945,2.212994962159642,1.96,1.0135600493536732,2.099198874030175,1.97,1.357768301252331,1.8143388500069082,1.98,0.8458840313979914,2.2490630949281045,1.99,0.5837888734093417,1.798069126839448,2.0,1.166291175149156,1.752280256424795,2.01,1.2639980921120724,2.223831499754789,2.02,0.7439375366871275,1.9681020078763587,2.03,1.0322946391382744,2.2284417182561764,2.04,1.1135931690994436,2.3167235296122604,2.05,0.7063244789844492,2.15162876070362,2.06,1.028004626103985,1.7400111941800125,2.07,0.7643890567290035,2.247327313264645,2.08,0.6119526070979482,2.0563119892544495,2.09,0.8206242707710532,1.9357572375683454,2.1,0.8191755713776503,1.863006116121921,2.11,0.8155354463512944,2.3869868607471116,2.12,1.0103225502097959,1.9695111087867316,2.13,1.2975728937486468,2.081289749140055,2.14,0.7798735514758816,2.1153312383253966,2.15,0.7189005245823479,1.6465468387977473,2.16,0.6986417935362176,1.6851321022741892,2.17,0.690833148546571,1.8496259015168497,2.18,1.0627677251138892,1.7670672162246546,2.19,0.6512178027905718,1.8668013001146722,2.2,0.6509854672497042,2.001288365242748,2.21,0.5677029315528865,1.5750474195633095,2.22,0.3120192685526839,1.6158642662108906,2.23,1.1389317445455605,1.6540484996323912,2.24,0.7243157673843392,1.8454300487432365,2.25,0.5299175819196007,1.4093341691005568,2.26,0.8859130924104746,1.4946593886760249,2.27,1.0742787196198258,1.7262096340820579,2.28,0.9237842656511487,1.386343279096365,2.29,1.0627867649960023,1.1615689749008193,2.3,0.7194877974007753,1.9406547702604644,2.31,0.6474155677173562,1.3435399470045093,2.32,0.583547630831506,1.1381175796749943,2.33,0.5325677412539862,1.730938166142046,2.34,1.0085575774117688,1.6202944332089906,2.35,0.887860657708986,1.4395796076161362,2.36,1.1731547136075007,1.2704364915263435,2.37,0.46333070178271596,1.333505285789843,2.38,0.9281905641170881,1.473859255307826,2.39,1.0953940529806867,1.777942080387186,2.4,0.7120634357997596,1.3367259818483956,2.41,0.7825308530820887,1.7215577322244107,2.42,0.7409897423784212,1.310485182902497,2.43,0.5858010007075899,1.186145201514079,2.44,1.1244774914677729,1.1848629753421618,2.45,0.6942398731358219,1.2858357708633905,2.46,0.7491599840603169,1.4038381422528943,2.47,0.6289297315813736,1.4116877229509261,2.48,1.0396097922561618,1.050591374030939,2.49,0.7533200282638459,1.4809033431435237,2.5,0.7622777858502037,0.7808348824142383,2.51,1.1001169171522376,1.3218779124026583,2.52,1.3708768106059916,1.1410090291602628,2.53,1.0729989830951117,1.1917579450667932,2.54,0.7635988914072376,1.16425282984012,2.55,1.137816537261179,1.4443939617294597,2.56,0.9065717790346248,1.04844333378782,2.57,0.7097657118429275,1.1762508184704914,2.58,0.7426919242906024,1.0527987825612088,2.59,0.8919704126214323,1.1514113180329035,2.6,0.5203822104718214,1.0231602470759045,2.61,0.7584046867588214,1.1857603134058605,2.62,0.7117511373934757,0.8942012697446813,2.63,0.8139187043410363,0.835381263061259,2.64,0.9305854985785332,1.0410799865569764,2.65,0.7720714250170179,0.7399813061387854,2.66,0.8665655337958041,0.9184115189473784,2.67,0.6226243356836769,0.9667428541531915,2.68,0.8942032431208679,1.2674375245039973,2.69,1.0709558020956051,1.3577172095867671,2.7,0.914859042690237,1.0489949912513266,2.71,1.383860415035373,0.7557940062672551,2.72,1.0792281257663257,1.014644374566306,2.73,0.7927760626973879,0.7314435322425165,2.74,1.063884076395786,0.5418285971326535,2.75,1.0626614775268373,0.48332479623047087,2.76,0.6957754676278398,0.8386053181770811,2.77,0.7336209352788814,0.7231693671889614,2.78,1.020578250695643,0.6432999286751863,2.79,0.9863716780108929,0.8165026965676865,2.8,1.1449456542864722,1.134825190247135,2.81,1.1801440560533858,0.9666140623127432,2.82,1.2566603583572178,0.7387823222754977,2.83,1.2530430246308948,0.9256490220874591,2.84,1.364016710639729,0.9573524700156668,2.85,1.3023833732259464,1.1388448153319857,2.86,1.101350481362554,0.7539036301948927,2.87,0.7307100010641953,0.8553560568141589,2.88,1.2355721675143472,0.8222929387654909,2.89,1.1887587906213644,0.7315498755268175,2.9,1.220400666008882,0.670254252029709,2.91,1.5400681158220777,0.799592336899042,2.92,1.3822247150671003,0.8228597376661854,2.93,1.280601782915936,0.9390809570568438,2.94,1.2662338818566479,0.9517682733305673,2.95,0.9101946917356465,0.842925326536793,2.96,1.2869340840183179,0.6866093918525702,2.97,1.7834865660352501,0.8580123877142334,2.98,1.6054485098373064,0.4561651612546335,2.99,1.4553563777136496,0.8730845983491127,3.0,1.3886186163865049,0.9370772110223358,3.01,1.5692575550285557,0.7639996777821291,3.02,1.137510067505801,0.7720867949226508,3.03,1.3795294210196107,0.49059838423714325,3.04,1.500497546361021,0.3387571812392564,3.05,1.7443111543940788,0.6015884213906206,3.06,1.500498228519984,0.5034183917045102,3.07,1.656395319783736,0.47708158515290017,3.08,1.623932221995836,0.504297000639611,3.09,1.303805875916974,0.5181466590241512,3.1,1.4449304052094298,0.8270741717504877,3.11,1.6928401043591466,0.3901195933890724,3.12,1.6509962530875657,0.7180548677903247,3.13,1.711360621939023,0.8538164316264223,3.14,1.7897762872010488,0.7561677019783622,3.15,1.8626864590697658,0.8644633585047476,3.16,2.2409192010909718,0.49020707536618013,3.17,2.178737498458009,0.5823152290590482,3.18,2.2273677811923163,0.6858622961862559,3.19,1.9219700742112877,0.5858021433830191,3.2,2.0443163794844326,0.5460773348879607,3.21,1.997734129180287,0.84890636842309,3.22,1.629770275039083,1.0496813686582676,3.23,1.9210844279677886,0.7879952247575518,3.24,1.8270647239115714,0.4485162980542294,3.25,2.0028617617485027,0.39309160583724717,3.26,2.0255790374929297,0.8734757506062962,3.27,2.048743315405754,0.6341073542659182,3.28,2.3296649475413904,1.017477004166842,3.29,2.7317447929930134,0.8569936126503923,3.3,2.3545440709081893,0.7941761502836587,3.31,2.2200099626199785,0.9290481472681227,3.32,2.236920329140511,0.631237093447086,3.33,2.3014687000830265,0.7601073638463262,3.34,2.6686529380394832,0.9864570457142519,3.35,2.639314615105396,0.5138140374059968,3.36,2.3909683874272494,0.8843143643999684,3.37,2.795671934445007,1.006561115596391,3.38,2.8075247468439346,0.5584016868092817,3.39,2.5857492264308672,0.8271407317951943,3.4,2.7122844150811813,0.831107983496409,3.41,2.7758981858274288,0.6368289359124656,3.42,2.8336495712909953,0.9760641683501623,3.43,2.8329332511535092,1.033342226447769,3.44,3.2432071696829228,0.8259589450474693,3.45,2.773018178763293,0.7611846982504704,3.46,2.8044881246711184,0.8818234225544309,3.47,2.9565664024502385,0.8260104863251989,3.48,2.99143537206267,0.6791430721277019,3.49,3.0387032610249864,0.6599077046917755,3.5,2.9080108143605834,0.8640889732846994,3.51,3.1716913376795715,0.8166229731247442,3.52,3.5677310613244617,0.7513862244503224,3.53,3.383604932803528,0.6878886161628661,3.54,3.4441828863193718,0.7755396089443504,3.55,3.444555090187697,0.9380211121671975,3.56,3.2401656735791686,1.0839269382599375,3.57,3.439796769572349,1.207469724065135,3.58,3.318849945834521,0.9304072651777695,3.59,3.2995786165072696,0.4942899113165482,3.6,3.430586194791578,0.6498288812686284,3.61,3.406492772358093,0.9154851168347139,3.62,3.7118881941370545,1.1265674376950512,3.63,3.571760423485351,1.058732912571716,3.64,4.155657472725945,0.9535227996806671,3.65,3.8144563747700464,0.8681669914953192,3.66,3.9359492051017284,1.2169910128359345,3.67,3.528590720958142,1.1499030019508165,3.68,4.109905553120379,1.0638960644088797,3.69,4.045796334545698,1.2758236404292198,3.7,3.6724529253102602,0.8883403654819115,3.71,4.046005255086986,1.0541405541350555,3.72,3.7765416726333374,1.2498624853768905,3.73,4.469971652862149,1.0839307566674579,3.74,4.228275437245985,1.4065025907609319,3.75,3.9488106848863045,1.2206619281141573,3.76,4.0482166435395825,1.6760275041191273,3.77,4.296878335291239,1.195774276825841,3.78,4.405113543184753,1.1021281875174112,3.79,3.729844395047192,1.6161445884388854,3.8,4.496489870419789,1.3164685359394497,3.81,4.577045214012909,1.5937349352866683,3.82,4.2154883912117835,0.891815430538095,3.83,4.172475827179526,1.5625910908347291,3.84,4.3234605310432395,1.4759625300380006,3.85,3.7332067626883596,1.5284533326681207,3.86,4.125194631042692,1.472865908342905,3.87,4.880353338049279,1.155676809943731,3.88,4.3683828339914506,1.6968577168851948,3.89,4.2759461530536305,1.6974507758126047,3.9,4.281495835898362,1.80238117940915,3.91,4.69074591641653,1.4857277164157008,3.92,4.407367613585688,1.7525501116517788,3.93,3.9881134307669868,1.9517704498860997,3.94,4.15938001496773,1.6971603655143466,3.95,4.216406285045702,1.7065194432954738,3.96,4.3123938601945415,1.9878665766349222,3.97,3.9713570858192067,1.6396698990704897,3.98,4.324917713617724,2.065545224343898,3.99,4.398278780768667,1.9932667056741626,4.0,3.714355957000438,2.1669482725150457,4.01,3.6541713623597656,1.9513676767896009,4.02,3.974955729964032,2.0427383751060884,4.03,4.265143785731212,2.232554724994495,4.04,3.8528193970591813,1.9568140095455961,4.05,4.050631642678458,2.4195878714468466,4.06,3.5287990997272463,2.126512523590597,4.07,3.46133889348159,2.161993328019015,4.08,3.8518435766214947,2.4761031869179164,4.09,3.162622651179539,2.136632718948933,4.1,3.3966620250329767,2.357034476069543,4.11,3.181178202335717,2.24775130230936,4.12,3.402757519430781,2.7724822933788653,4.13,3.4225240208131766,2.409724368465312,4.14,3.204436957944081,2.6074769679191965,4.15,2.9963209456950035,2.418362927396508,4.16,3.038603292339582,2.6439683720760683,4.17,2.664425080649296,2.7474822052014107,4.18,2.798020977940009,2.8400688014644473,4.19,2.730844931663201,2.893204583071302,4.2,2.55099337228026,2.702419876277637,4.21,2.826480288331819,2.7827411996530698,4.22,2.656237488269432,2.639708139695797,4.23,2.5777608797602243,2.6401538772962923,4.24,2.5616617761051708,2.895649014175869,4.25,2.588346917950694,2.577446297111005,4.26,1.9677067424468513,3.0614314117790657,4.27,2.6267669314228788,2.6038489674076932,4.28,2.194121163549542,3.1905251500123653,4.29,2.424808687914503,2.4974502412061628,4.3,1.8873246678799347,2.9296811541484438,4.31,1.854781178633124,2.887498687652754,4.32,2.202945881267647,2.6510158438151663,4.33,2.3757643355830127,2.549321724059296,4.34,1.9086743845824017,2.841926237113323,4.35,1.6146363896867986,3.0115345499616484,4.36,1.7150333019397208,2.86259565290055,4.37,1.8781091355171013,3.0101690931150897,4.38,1.4694768047813287,3.0567728709614004,4.39,1.6430665479981512,3.022304806794602,4.4,1.539038834312233,2.8847666401241803,4.41,1.6222487679014808,2.943331891464817,4.42,1.6127474802004171,2.8158194570467643,4.43,1.349160225156874,2.6159511350908935,4.44,1.2799143696078998,2.4774825781392593,4.45,1.1558415570213882,2.6371623218681592,4.46,1.213404234783244,2.6282978316408436,4.47,1.3671928120407704,2.5805123265688,4.48,1.1983301906747053,2.9075211631240556,4.49,0.9347152216288632,2.827413318945958,4.5,1.29130376694084,3.0137841280185835,4.51,1.3237587377958506,2.5696665961398404,4.52,1.2273480094272555,2.656288472499893,4.53,1.260291582947046,2.438391285878108,4.54,1.2219293610235804,2.471931415108058,4.55,1.2205978331152472,2.485961809186958,4.56,0.9990833908651997,2.3937290490104743,4.57,0.9933421400224289,2.364003837423574,4.58,1.0373762332655379,2.447549360584254,4.59,1.0282243154016986,2.189189958447827,4.6,0.9382458917959419,2.485970853564102,4.61,0.8019865288745573,2.4538880776290264,4.62,0.30803727758256816,2.7553002156923947,4.63,0.9665135122766885,2.176071521262452,4.64,1.2185959128307313,2.721332023667635,4.65,1.2707359221558572,2.148375680284601,4.66,0.8622059881877602,2.4527123241593634,4.67,0.7704664501326227,2.140194371387059,4.68,0.974390766359058,2.1717165390916326,4.69,0.5836294316445003,2.713852208290541,4.7,0.913898394100734,2.324883577269828,4.71,0.5938593160829526,2.4745005338456543,4.72,0.9024738540536684,1.89458166647287,4.73,0.8022146741596531,1.8893049585710666,4.74,0.7696907749893409,2.1550967572535575,4.75,0.4507743753168039,2.152306633587855,4.76,0.8144798972905711,1.8903874406751375,4.77,0.8799299701028523,1.921629255172585,4.78,1.0402570335736194,1.9722463131155705,4.79,0.4869929638151541,1.6359058989781552,4.8,1.0610994619132197,2.181709688831878,4.81,0.42648325402027065,1.8970792736029807,4.82,0.758451726882917,1.7748071245058754,4.83,0.9682048228451154,1.8491691767874114,4.84,0.4863067117815585,2.253077295134843,4.85,1.0893157108120992,1.3438003689872142,4.86,0.611855067471901,1.4061076065791824,4.87,0.7062549248949243,1.929422280064047,4.88,0.6611091155204877,1.9560388120490009,4.89,0.5993213407223166,1.7471912772614115,4.9,0.9478914844379714,1.8919290235045452,4.91,1.0796883122588983,1.5868208863031956,4.92,0.7451041688307086,1.5612109644644867,4.93,1.1183972146454915,1.6428524954690251,4.94,0.93824869439401,1.974073946754861,4.95,0.9014052606802417,1.7340297012376928,4.96,0.736377564432536,1.4815555963577116,4.97,0.8387197691565456,1.5277980428262876,4.98,0.7150432899446434,1.7984542153998362,4.99,0.6200096223131559,1.3919056765343851,5.0,0.5361235339181321,1.723885379318318,5.01,0.8726859208597127,1.2297672819752408,5.02,0.9292774138724446,1.063888361518229,5.03,0.960292598442787,1.4055432347636307,5.04,0.7013186961175458,1.2126815668409818,5.05,0.5208745325456842,1.386326767096931,5.06,0.6533200095112119,1.4751456961620306,5.07,0.7960581593540206,1.3137269339561388,5.08,1.2784046243503888,1.1131555416744785,5.09,0.7623885136516421,1.5917949289657338,5.1,1.0597002378471456,1.193240495545422,5.11,1.036531171991049,1.8174471883237269,5.12,0.7910081406151375,0.9774377015583389,5.13,0.7640861444877242,1.3151669692684367,5.14,0.7414844586834907,1.158013442317809,5.15,0.7766179566342205,1.0850686119218862,5.16,0.964771787347673,1.0855928766485716,5.17,0.5822500964782602,1.3563958906407618,5.18,0.9020117198039991,1.287822773212291,5.19,0.631633437743681,1.3799705939520828,5.2,0.7526181241537703,1.064566808803256,5.21,0.6715487255201282,1.1437962997081574,5.22,0.5892371132905683,1.214667597818921,5.23,0.5111152704125717,1.0191913569928128,5.24,1.0597754643543287,1.150871439399244,5.25,0.794642153637397,1.0639980880060063,5.26,0.7820383966852902,1.210938244550694,5.27,0.7196747996902427,0.9298883240246317,5.28,0.6121158983679689,0.8980966170811113,5.29,0.5873215220617649,1.3107345959872037,5.3,0.6075916503778449,0.903769583226655,5.31,0.6845572535372868,0.713919464610707,5.32,0.6493131795622511,0.8588201202832402,5.33,0.7769434414479653,1.0338347537353734,5.34,0.8935970841787048,1.0827994434944772,5.35,0.9363229179479109,1.0320040928769536,5.36,0.5944445803123433,0.7569051844217165,5.37,1.1084819324075559,0.7494147918152217,5.38,0.831615752875418,0.9040778105321979,5.39,1.1150316997072227,1.2197046028782945,5.4,1.112993941520571,1.0436761183688117,5.41,0.9538414773558136,1.0524962034483938,5.42,0.9901681432325111,1.2170168045901086,5.43,1.0218091860191805,0.7414570911596129,5.44,0.7561683778527114,0.9465308779304352,5.45,0.7317834845159409,0.845005036290694,5.46,0.7285488406762036,0.6604194076712315,5.47,0.9858669631828322,0.9773083021199316,5.48,0.8541559578756877,1.0290069390794228,5.49,1.0057320520592394,0.49896267525091265,5.5,1.0163787638737474,0.9655081236663399,5.51,1.137453072410131,0.91763906234829,5.52,1.1109036047398504,0.6082629383141988,5.53,0.9433064280958445,1.116980614340847,5.54,1.091480439363318,0.7445542133354802,5.55,1.0760806235906337,0.6408008891648653,5.56,1.151756933419378,1.0214210393757637,5.57,0.9727015276852288,0.768681865352813,5.58,1.1076293233494696,0.4116039038346715,5.59,1.4444152473044756,0.5384589350275842,5.6,0.9595668406364262,0.6651392909720962,5.61,1.3811224136892999,0.6762880460710119,5.62,1.3147171986521227,1.1273437009953902,5.63,1.174310962597466,0.7446208020286644,5.64,1.59587821476033,0.5368596947524179,5.65,0.9787902579173686,0.65293275163072,5.66,0.9473643055998615,0.697057826019919,5.67,1.535569173590489,0.9429040287214342,5.68,1.418057339502064,0.7487631355266169,5.69,1.394241728653633,0.1820990948575273,5.7,1.6014305790298926,0.8301086828125703,5.71,1.5103488042483975,0.9623277385372179,5.72,1.3868799750987908,0.9431973033711061,5.73,1.0409603618103025,0.7274520464612384,5.74,1.2024910360178866,0.19534259299516632,5.75,1.4856592329485514,0.2936712972661631,5.76,1.514034747176429,0.5520390184305666,5.77,1.4868561124406738,0.6599774856211985,5.78,1.2765081931970157,0.8993046110837403,5.79,1.7672362643434867,0.31236040156362993,5.8,1.3968318898964025,0.8787771218706963,5.81,1.6664921422806014,0.41215657566561503,5.82,1.9515929388909639,0.6234747266118978,5.83,1.817003083160308,0.5003875235655789,5.84,1.7739471323986535,0.5517561897138747,5.85,1.6140585993039462,0.6117862904699151,5.86,1.7759568661700207,0.7792160501646455,5.87,1.9810176787948846,0.44928321387683956,5.88,1.813715618720429,0.45383353431329265,5.89,1.9514973870437546,0.8692300655106845,5.9,1.8264644428173002,0.8199269225505057,5.91,2.017761030786631,0.49279234330397287,5.92,2.0711618286480045,0.6375204942470138,5.93,1.9714031606686906,0.47937546769367784,5.94,2.047088857361915,0.7119796669266629,5.95,1.7489337957885909,0.638558823142584,5.96,2.1265686481759785,0.9306375591101992,5.97,2.2668362783557447,0.4330459059805433,5.98,1.8205720138987083,0.27836081204894425,5.99,2.5033056144866483,1.102310947791596,6.0,1.9256132985945458,0.673546794868149,6.01,1.7759704461369323,0.7222892500829153,6.02,2.1520634118050217,0.793203086437455,6.03,2.174248399940155,0.6156104291255319,6.04,2.599490160951573,1.0010667360099101,6.05,2.319863472668282,0.9999412499284783,6.06,2.454326506293957,0.8410721740779269,6.07,2.6978704206843647,0.793314500620999,6.08,2.1034866879195784,0.6348467484124166,6.09,2.9898336569420874,0.5729224920537103,6.1,2.5996870247218546,0.31697334757142526,6.11,2.404432780736069,0.4544193112003823,6.12,2.8806818041716675,0.7760480569524422,6.13,2.616853293221694,0.25427971538176614,6.14,2.7938615439475614,0.6531698094386547,6.15,2.761219297551689,0.5971828015722882,6.16,2.9994144293386347,0.91169048409709,6.17,3.096999146056038,0.8614952789429677,6.18,3.257329942891621,0.7082022360134193,6.19,2.837807055584379,0.9169054155328178,6.2,3.221590864635033,0.851793750138778,6.21,3.062176930437895,1.1299152978641263,6.22,3.6264800083570408,0.6559215779921159,6.23,3.1889973454562655,0.9951538589699672,6.24,3.5258565313446932,0.7486833929473597,6.25,3.6545650717420646,0.6039367927937777,6.26,3.742831167954424,0.8332269653301866,6.27,3.555431669952468,0.3791265639219643,6.28,3.9461191467559953,1.0462253610425816,6.29,3.4959238497585656,1.0334069632945826,6.3,3.643858817278639,0.7593394129282817,6.31,3.6337945288690237,0.46156428207424943,6.32,3.7911156695712376,0.8230454663226001,6.33,3.429874811131566,0.9097825687699901,6.34,3.4348281709035637,1.1768401238551112,6.35,3.5589007955080723,0.9988989638264664,6.36,3.7047425721025893,0.4753289372454268,6.37,3.853336105082906,0.9643515549566735,6.38,3.9351336796771212,1.097811503649343,6.39,4.079284101491908,0.9847833766001689,6.4,4.154203867078577,1.177584302666303,6.41,4.267540120632805,1.018716438493289,6.42,4.370335312088968,0.8408400237834339,6.43,4.024141062398341,1.1208602621318142,6.44,4.543512031431405,1.1472627245043183,6.45,4.418338019001059,0.9948702964354396,6.46,4.433946044544018,0.8036208750035037,6.47,4.066280540688847,0.9781598061257343,6.48,4.510758359891607,1.1510430763242325,6.49,4.336482862257395,1.245811276218456,6.5,4.203810371491464,1.0588947093478605,6.51,4.399641796255633,1.2561702404393305,6.52,4.443929620308729,1.042684551870484,6.53,4.051402217865242,1.5135097470728822,6.54,4.264301994532039,1.404348783693345,6.55,4.42400345065097,1.4273501441082665,6.56,4.362065176944761,1.4364514542144846,6.57,4.378437126579591,1.5061066275755113,6.58,4.984593307225643,1.3383520791202617,6.59,4.466089894915959,1.7083029304371182,6.6,4.641758469226222,1.5326529090590546,6.61,4.278163677325334,1.676902617645026,6.62,4.312076793614702,1.6347904498321753,6.63,4.307753324180273,1.8125038656583694,6.64,4.529807170962841,1.4263897507845702,6.65,4.578037382430225,1.8438786884208467,6.66,4.696637037723271,1.6499829698625759,6.67,4.070955688896846,1.7064184030709948,6.68,4.572102950041709,1.9247819695152772,6.69,4.865487583483803,1.449361603555952,6.7,4.296309870555919,1.9487973074769387,6.71,4.324451428371137,2.1987321097713393,6.72,4.068943119397223,1.9869894834395367,6.73,4.036911637041486,2.6002164649643125,6.74,3.949408174554147,2.1343094776778,6.75,4.127391964771095,2.5369371796258853,6.76,3.667010797323429,2.2230016154807886,6.77,3.922165234347597,2.5643294955074256,6.78,3.7206927135761747,2.3770803373450424,6.79,3.784513375842681,2.6368274868006827,6.8,3.622203923270634,2.343526165632942,6.81,3.4073901615408486,2.3747109508445114,6.82,3.6134792381442153,2.481390493066757,6.83,3.123295660480929,2.6429493453022785,6.84,3.1587261087870804,3.074135094453306,6.85,3.256512679299161,2.4334264158021965,6.86,3.197506822019016,2.558283381071857,6.87,3.3791741040044685,2.7686041813448026,6.88,2.86664735874171,2.540726225121887,6.89,3.1209017686962266,2.4566904484098537,6.9,3.476401336757743,2.7437663628082043,6.91,2.94177837378613,2.711227960244224,6.92,2.8238720995410382,2.787336752429913,6.93,2.9381960996553205,3.1093896753481918,6.94,2.7460674060986037,2.3653109969734603,6.95,2.7760025826389683,2.9988254450936815,6.96,2.5661453116761663,3.1910907728722346,6.97,2.8135488739022603,2.749773914652922,6.98,2.3169909470054746,3.1282661762519552,6.99,2.4714993520845043,2.9788618651177887,7.0,1.8892601659738388,3.0102512733700237,7.01,2.346277436487754,2.986577179386613,7.02,2.2731406214443104,2.667218564475599,7.03,2.283041753028914,2.7763071396508656,7.04,2.1900933050252305,3.14240675082586,7.05,1.9038092260166346,3.333092309410554,7.06,1.9428173110601596,3.2928672697909067,7.07,1.7821693837011927,3.140712955958341,7.08,1.2578871350318694,3.25384653832248,7.09,1.6712976656390914,3.1077656420489097,7.1,1.9698020274875223,3.456946819658307,7.11,1.7792149731586133,3.1060421415446644,7.12,1.5803535704382388,2.9391309287606373,7.13,1.513081612221463,3.1049552164244325,7.14,1.2347387681413717,2.952027186837373,7.15,1.2977198275796735,2.925409274775479,7.16,1.7404028972201024,3.126199931167793,7.17,1.2168642258967273,3.211929728093949,7.18,1.309475933185277,2.844932575977484,7.19,1.331022122808068,2.889737929848086,7.2,1.1067468395909885,3.1034195284400514,7.21,1.372620444517154,2.4629333453197573,7.22,1.2913770174412238,2.8261626113030296,7.23,1.0002337519226427,2.8995413702119515,7.24,1.1083228949825792,2.58421608370507,7.25,1.2576118628002568,2.5689804753713696,7.26,1.328580137692792,2.781713722958819,7.27,1.1433725047688883,2.498224668993722,7.28,0.9622523415206011,2.6953881508537014,7.29,1.1284103188900036,2.591766112639343,7.3,1.343695291294453,2.573848731965955,7.31,0.7214091593082798,2.4692618047054795,7.32,1.0156953562943811,2.4832884664321466,7.33,0.9299475368453749,2.4623163885974892,7.34,0.9340655832299127,2.299203880040855,7.35,0.8152552996620309,2.3629505444732173,7.36,0.7018516185929318,2.5946052114112224,7.37,0.9045720270755293,2.055455277740282,7.38,0.7485894569947255,2.1662111210729487,7.39,0.45190721681458823,2.516836061432317,7.4,0.7280570240117925,2.1827428159204643,7.41,1.2015167837722454,2.4095480411553463,7.42,0.816791942803274,1.9911839836866854,7.43,0.645172604629921,2.0099474581830465,7.44,0.9125715404530598,2.1350839405572577,7.45,0.5968969142510594,2.134197138470761,7.46,0.8731833941243968,2.035901287926412,7.47,0.9315541661785152,2.1892724463165814,7.48,0.49724546689908955,1.9651256077020558,7.49,0.9079230762270225,2.1693675534571857,7.5,0.6570877041657597,1.8904130719431789,7.51,0.8735970228393604,1.923848196049785,7.52,0.643395203495106,1.876519050245026,7.53,0.6349640114082002,1.8729876884487828,7.54,0.6802160271578183,1.7708374351184846,7.55,0.5201172375381796,1.9562511727926943,7.56,0.5810182567900222,1.678801871449407,7.57,0.6631642048105172,2.2725188298856667,7.58,0.6891802416704929,2.115541277917919,7.59,0.41368688364639217,1.8637937440606884,7.6,0.6299040463889645,1.7732905700566877,7.61,0.8877414193350196,1.3934537211007911,7.62,0.31607500331266564,2.047449804196783,7.63,0.694450935370715,1.8014784838044493,7.64,0.6748713743171243,1.523928204911613,7.65,0.7403216649912088,1.6825794469702617,7.66,0.6512531509926597,1.5123243989120758,7.67,0.663792400504821,1.4010345356853007,7.68,0.7016519150403998,1.5912560844742336,7.69,0.9126573139518128,1.0264362245034184,7.7,0.49304116025639755,1.5221715330266443,7.71,0.5490576039368398,1.3888842306801625,7.72,0.2496542295835017,1.3694920607959076,7.73,0.3284381795209675,1.2869064861783448,7.74,0.8755424137599437,1.331517012829524,7.75,0.62898485298962,1.5496945065980412,7.76,0.6030623949605258,1.5203433969718203,7.77,0.7039237227039769,1.3050389407751393,7.78,0.6090261778271554,1.627067295513269,7.79,0.7451758364896471,1.5699642148300055,7.8,0.5968928455364384,1.3536462885840508,7.81,0.792596665553277,1.29899814005373,7.82,0.605390449890906,1.0931923635564718,7.83,0.7230349870210635,1.4221025380623484,7.84,0.6395569551198461,1.3475936691158958,7.85,0.6898427759012249,1.1776360177278535,7.86,0.3488169698946642,1.3220380659947297,7.87,0.9205465775379815,1.0876026639033958,7.88,0.37752205069389144,0.9643405245684533,7.89,0.9371722243551328,1.1008880621459132,7.9,0.75107036818583,1.0339836667195406,7.91,0.8480104903625121,0.9677240315237008,7.92,0.6212521774962639,1.2296860123246576,7.93,0.7861918872101072,0.7542378448324096,7.94,0.5908252970351764,1.1310582469350738,7.95,0.34338268399780036,0.9816249217586619,7.96,0.6393202017543316,1.2735705446040375,7.97,0.8557971843449179,1.121670000743662,7.98,0.5378631075367646,1.3719899054142044,7.99,0.5101877740864723,1.365878143300695,8.0,0.6668104508918059,0.8326370321271,8.01,1.2066795692914738,0.8987276222673521,8.02,0.9858340709573137,1.0230746075748633,8.03,0.6614178541204807,1.0711090194640087,8.04,0.9785243825752304,1.324725895839951,8.05,0.9550367413023738,1.1283756790819324,8.06,0.7185310698281548,0.9229915904167277,8.07,1.2591417872376585,0.7838700760867008,8.08,0.7789940853257453,0.9570395093725057,8.09,0.5126518145727842,1.3730608728150817,8.1,1.040809265291164,1.0703329607245817,8.11,0.7170786617265582,0.863956399279386,8.12,0.7969698141711359,1.180490390536049,8.13,0.6602428600552204,0.9754792751515664,8.14,1.1281337672972778,0.91523978858007,8.15,0.9443989531412406,0.6162455876034539,8.16,0.7938549569713079,0.8428965649936907,8.17,1.0689357134317448,0.49922114030901216,8.18,1.26618462400718,0.5531781879013596,8.19,0.8984207327542956,0.6695427202178923,8.2,1.0151321537999543,0.8178766674600964,8.21,1.0274980239724745,0.7825575138407148,8.22,0.7779249799865273,0.7958936351915602,8.23,1.0214200268807303,0.5251425012208515,8.24,0.7119114046609646,0.9671082700311512,8.25,1.242176621114621,0.6102948445047187,8.26,1.0859310833867717,0.09659526432822652,8.27,1.0129712278676462,0.488798385206379,8.28,1.0454577667812042,0.48697789574137423,8.29,0.7103710985321137,0.6567457498727434,8.3,0.7222130880389985,0.38446302120245934,8.31,0.8737418677519565,0.9611357333326054,8.32,1.0876124119509711,0.8648022170423788,8.33,0.9927546071495009,1.0670043674090297,8.34,1.06274257055628,0.6594319283203098,8.35,0.9918953405753131,0.5499112851565217,8.36,0.9156422837565699,0.8209525932695363,8.37,0.7533330943279255,0.6326307642417249,8.38,0.9271104264490396,0.6278300804894646,8.39,1.021664475121458,0.7553380023743694,8.4,1.6794080348607698,0.18234908924984428,8.41,1.2683631666908213,0.6639309105165161,8.42,1.5800177509714743,0.7492370787751281,8.43,1.695740652389525,0.5217465663966968,8.44,1.1416714444050498,0.5042734854569559,8.45,1.1174686831191205,0.7177849155143045,8.46,1.161147271127489,0.7809286079999692,8.47,0.8805496061167629,0.4512415666676035,8.48,1.5088001328896117,0.9171666682417565,8.49,1.3146079736140672,0.8770243440101686,8.5,1.2148975441618923,0.18072722224186355,8.51,1.4790121816641004,0.9212881419669594,8.52,1.4121981611522727,0.7160501312794041,8.53,1.6533150397495417,0.5073864777246748,8.54,1.3977274992824018,0.7258224192498253,8.55,1.5436568652138276,0.6132409227101607,8.56,1.4462762630134616,0.3250446682530695,8.57,1.2063064714012257,0.42464549732892365,8.58,1.6555232010107268,0.46182151731554594,8.59,1.3073426324013053,0.7047169209498931,8.6,1.7707402325538255,0.5615960784346329,8.61,1.733606518720465,0.8687756288366092,8.62,1.815536514102736,0.46935489081816434,8.63,2.0042354249938437,0.507500697560649,8.64,1.9338439056195496,0.8833894793963066,8.65,1.6123615533839688,0.46688014281033574,8.66,2.0481159441789796,0.8866024619781667,8.67,2.0057649929461236,0.5619214721012135,8.68,2.0023322713725977,0.635754768665086,8.69,2.3561941547900265,0.730988767964013,8.7,2.2232541859750765,0.7359733960573609,8.71,2.1374696697573357,0.7282076148711497,8.72,2.00929051521747,0.5842065098614893,8.73,2.051754591384316,0.3347272255535666,8.74,1.92414223252858,0.19066636316988927,8.75,2.274220591014234,0.6154724585732794,8.76,2.532992989529698,0.47205446310089566,8.77,2.574396894869018,0.43559668654338046,8.78,2.4094857380064307,0.6292866719719764,8.79,2.1584897146473185,0.5263187374709929,8.8,2.3862847247759738,0.1947392476790058,8.81,2.5641975438030005,1.0950748682752136,8.82,2.9301186539958173,0.49691984401004835,8.83,2.1175639641459,0.9333261198924512,8.84,2.427091968502794,0.24326156358588147,8.85,2.5132151773550206,0.6311818369350817,8.86,2.6890984213013716,0.8022658796607038,8.87,2.7763731494798503,0.7164025943683793,8.88,2.6752779163584854,0.8329711440146121,8.89,2.6345863860501857,0.5259951316226059,8.9,2.9576842675520165,0.4837109454829116,8.91,2.819284174778445,0.8070422681854045,8.92,3.2821717747114603,0.6941711151696986,8.93,2.9730143070346644,0.716237274185198,8.94,3.5934731662541775,0.5995747705448086,8.95,3.329742950111208,0.7819981707454914,8.96,3.4178268462859522,0.37622097796370146,8.97,3.3395568600436083,0.7047797130192099,8.98,3.1558214925393155,0.6482030208887144,8.99,3.491036793053872,0.7723879211815173,9.0,3.5418229588546195,0.6520918200125979,9.01,3.4512364713814483,1.0353969133087313,9.02,3.729419330647269,0.8345640825888871,9.03,3.8418820864703327,0.7001637786533615,9.04,3.516878545875596,0.5870593210924844,9.05,3.4148451843786964,0.5239182463607857,9.06,3.639794878408449,0.7250000453056216,9.07,4.152739345421453,0.6965661314733301,9.08,4.048070883233181,0.8724216801144075,9.09,3.924829268587241,1.0035487225807205,9.1,3.8175578675402777,0.2833582604066477,9.11,4.19412720357935,0.6916807360699069,9.12,3.982291866192756,0.8166123432484306,9.13,4.236311393981772,1.034540658958018,9.14,4.322917660018796,0.8553966670119082,9.15,4.258639406605894,0.8656391798004786,9.16,4.608423771261483,0.7239566190150666,9.17,4.619315966642123,1.0127404271979232,9.18,4.55763431061662,0.7728146895803263,9.19,4.144602951747909,1.280966190474749,9.2,4.277996836615191,1.117959259960734,9.21,4.45886292441497,0.999892360237856,9.22,4.460793600177539,0.8901229604196672,9.23,4.405303104272578,0.9553520441284657,9.24,4.732059248288891,1.1632662323337015,9.25,4.4678497716736345,1.3808989028655847,9.26,4.72485076283413,1.503637582319569,9.27,4.371465750986808,1.2833243314137055,9.28,4.754089977621212,1.3366426301764824,9.29,4.709217943072764,1.3830843363782137,9.3,5.274566562538437,1.4551450244210329,9.31,4.8723257397874935,1.1190119520843804,9.32,4.763849791663451,1.3157009976094731,9.33,5.025923387379227,1.099359940082938,9.34,4.588455341250027,1.7266269622473418,9.35,5.021264492565694,1.7555649084812306,9.36,4.7802488163852095,1.6983924732518223,9.37,4.820107249375715,1.7850885981788387,9.38,4.80353679281785,1.5085226082673417,9.39,4.651234019697264,1.5686034179069686,9.4,4.531191549819501,1.5270014800245468,9.41,4.988543820426855,2.021806533408517,9.42,4.568184354084061,1.844032499788395,9.43,4.479102438359191,1.8842076319483672,9.44,4.367243778317708,2.038953797110904,9.45,4.328986156009474,1.9895340724269397,9.46,4.373303238081175,2.3244479875804296,9.47,4.445614172918336,2.2026031668385655,9.48,4.361866109303184,2.523527917148253,9.49,4.380518546690104,2.0148235895382354,9.5,4.381401628216147,1.9909667302762042,9.51,4.003752985803329,2.2240474225779168,9.52,3.8802650094347726,2.240719248278699,9.53,3.8427171626011747,2.83513544986062,9.54,4.1791085989599175,2.2307712092359875,9.55,3.993308536371128,2.541496585527653,9.56,3.569907940415251,2.6046739904410416,9.57,3.645188473888739,2.609519057912961,9.58,3.4011769241034644,2.59871191254008,9.59,3.56781388598903,2.837722503093758,9.6,3.508364928823892,3.1422760740270963,9.61,2.8641817154771005,2.6588152031981553,9.62,3.041047256709463,2.804405774507134,9.63,2.7662876556997635,3.4113695440787133,9.64,3.1761868986611517,2.9244451795162343,9.65,2.9550948462233286,3.1839234566685315,9.66,2.885657925067238,2.7875273172368633,9.67,2.820352967397442,3.243064385668716,9.68,2.772423409589187,3.1464505729026224,9.69,2.740429589139801,2.945380360224359,9.7,2.8081562357784673,3.1976433778504436,9.71,2.560999109898741,3.3302935269579432,9.72,2.627012786091859,2.931849515524009,9.73,2.3166608235297064,3.442414243493739,9.74,2.2777299553169255,3.0678926126609354,9.75,2.173300300510063,3.39922562880594,9.76,1.9777776367216078,2.962584761951141,9.77,1.8341924238024478,3.233129544857666,9.78,1.7939413740208932,3.275484253617216,9.79,1.5277042905347673,3.0909296553848447,9.8,1.6152850101238374,3.5389830543524754,9.81,1.7890234746273086,3.5218656513563653,9.82,1.4466524831361462,2.9125387784377303,9.83,1.7108383750799188,3.065106212789417,9.84,1.7761125340405224,3.289666520493026,9.85,1.430253693891255,3.3843648274838594,9.86,1.4689077544364568,3.198566360837759,9.87,1.4534505944228073,2.9807391200121747,9.88,1.1390487558799256,2.8899445855388497,9.89,1.2342653208037062,3.121572496885211,9.9,1.505032691485468,3.0911022380676356,9.91,1.2044135753527119,3.3614025173351845,9.92,1.114576051774367,2.534184578106719,9.93,1.1746687763543184,2.795936310726534,9.94,1.1678430675376203,3.2101133489501694,9.95,0.9602510691145131,2.898149790878264,9.96,0.9586668177954598,2.579853795166528,9.97,1.1489916679787533,2.7807054639266764,9.98,1.0962140845023651,3.0805176189732597,9.99,0.6355452604944031,2.796228963036231,10.0,0.8571590506095471,2.3893746095481205]).reshape((-1,3))
    return (data,)


@app.cell
def _(data, plt):
    plt.scatter(data[:, 0], data[:, 1])
    plt.scatter(data[:, 0], data[:,2])
    return


@app.cell
def _(np, plt):
    def parameterise_basic_model(p):
        a, b, c, d = p

        def model(x, t):
            N, P = x
            return [a * x[0] - b * np.prod(x),
                    c * np.prod(x) - d * x[1]]

        return model


    basic_model = parameterise_basic_model([1, 4, 1, 4])


    def solve(f, tspan, x0):
        δt = 0.01
        ts = np.arange(tspan[0], tspan[1] + δt, δt)
        xs = np.zeros((len(x0), len(ts)))
        xs[:, 0] = x0

        for i in range(1, len(ts)):
            xs[:, i] = xs[:, i-1] + δt * np.array(f(xs[:, i-1], ts[i]))

        return ts, xs.T


    t_span = (0, 10)
    x_0 = np.array([1.0, 1.0])
    ts, xs = solve(basic_model, t_span, x_0)

    plt.plot(ts, xs[:, 0], label="prey", linewidth=4)
    plt.plot(ts, xs[:, 1], label="predators", linewidth=4)
    plt.xlabel("time")
    plt.ylabel("population")
    plt.legend(fontsize=16)
    return parameterise_basic_model, solve


@app.cell
def _(np):
    def gradient(f, x):
        n = len(x)
        δx = 0.01

        def Δx(i):
            z = np.zeros(n)
            z[i] = δx
            return z

        dfdx = np.zeros(n)
        for i in range(n):
            dfdx[i] = (f(x + Δx(i)) - f(x)) / δx

        return dfdx
    return (gradient,)


@app.cell
def _(mo):
    mo.md(r"""
    #part(e): Rescaling the Model
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Basic model:**

    $$\dot{N} = aN - bNP$$$$\dot{P} = cNP - dP$$We are given the hint to introduce scaled variables representing single animals:$\hat{N} = \frac{N}{100} \implies N = 100\hat{N}$$\hat{P} = \frac{P}{10} \implies P = 10\hat{P}$
    1. Rewriting the Prey Equation ($\dot{N}$): First, find the time derivative of $N$ in terms of $\hat{N}$:$$\dot{N} = \frac{d}{dt}(100\hat{N}) = 100\dot{\hat{N}}$$Substitute $N = 100\hat{N}$, $P = 10\hat{P}$, and $\dot{N} = 100\dot{\hat{N}}$ into the original prey equation:$$100\dot{\hat{N}} = a(100\hat{N}) - b(100\hat{N})(10\hat{P})$$Divide the entire equation by 100:$$\dot{\hat{N}} = a\hat{N} - 10b\hat{N}\hat{P}$$
    2. Rewriting the Predator Equation ($\dot{P}$): First, find the time derivative of $P$ in terms of $\hat{P}$:$$\dot{P} = \frac{d}{dt}(10\hat{P}) = 10\dot{\hat{P}}$$Substitute $N = 100\hat{N}$, $P = 10\hat{P}$, and $\dot{P} = 10\dot{\hat{P}}$ into the original predator equation:$$10\dot{\hat{P}} = c(100\hat{N})(10\hat{P}) - d(10\hat{P})$$Divide the entire equation by 10:$$\dot{\hat{P}} = 100c\hat{N}\hat{P} - d\hat{P}$$
    *The model structure remains the same (Lotka-Volterra form), but the interaction parameters $b$ and $c$ are rescaled: The effective prey death rate parameter becomes $10b$.The effective predator birth rate parameter becomes $100c$.The parameters $a$ and $d$ remain unchanged.*
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part (f) & (g)
    """)
    return


@app.cell
def _(data, np, parameterise_basic_model, solve):
    #Part f
    def simulation(p):
        """
        This function simulates the model for parameters p = [a, b, c, d].
        Returns a (1001, 2) matrix of Prey and Predator populations.
        """

        model_func = parameterise_basic_model(p)

        t_span = (0, 10)
        x0 = np.array([1.0, 1.0])


        ts, xs = solve(model_func, t_span, x0)

        return xs

    #Part g
    def mse(p):
        """
        This function calculates the Mean Squared Error between the simulation and the global 'data' variable.
        """

        sim_result = simulation(p)


        sim_prey = sim_result[:, 0]
        sim_pred = sim_result[:, 1]


        data_prey = data[:, 1] 
        data_pred = data[:, 2]

        # Squared Residuals
        sq_err_prey = (sim_prey - data_prey)**2
        sq_err_pred = (sim_pred - data_pred)**2

        # Mean Squared Error
        total_mse = np.mean(sq_err_prey + sq_err_pred)

        return total_mse
    return mse, simulation


@app.cell
def _(mo):
    mo.md(r"""
    #part(h): Gradient Descent
    """)
    return


@app.cell
def _(data, gradient, i, mse, np, plt, simulation):


    # 1. Setup
    e = np.array([1.0, 4.0, 1.0, 4.0])  # Initial parameters
    step_size = 0.01
    initial_mse = mse(e)
    target_mse = initial_mse / 3.0

    print(f"Starting MSE: {initial_mse:.4f}")
    print(f"Target MSE: {target_mse:.4f}")

    # Storing history for observation
    mse_history = [initial_mse]
    p_history = [e.copy()]

    # 2. Descent Loop
    max_iters = 2000 

    for ite in range(max_iters):
        # using the provided 'gradient' function
        grad = gradient(mse, e)

        # Updating parameters 
        e = e - step_size * grad

        # Checking new error
        curr_mse = mse(e)
        mse_history.append(curr_mse)

        # Printing progress every 100 steps
        if ite % 100 == 0:
            print(f"Iteration {i}: MSE = {curr_mse:.4f}")

        # Checking success condition
        if curr_mse <= target_mse:
            print(f"\nFound parameters at iteration {i}")
            print(f"Final MSE: {curr_mse:.4f}")
            # FIX 2: Changed 'p' to 'e' here
            print(f"Parameters: {e}")
            break

    # 3. Plotting
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))

    # Plot 1: Initial Parameters
    e0 = np.array([1.0, 4.0, 1.0, 4.0])

    sim_e0 = simulation(e0)

    ax1.scatter(data[:, 0], data[:, 1], s=5, label='Data Prey', alpha=0.5)
    ax1.scatter(data[:, 0], data[:, 2], s=5, label='Data Predator', alpha=0.5)

    ax1.plot(data[:, 0], sim_e0[:, 0], 'b-', linewidth=2, label='Sim Prey')
    ax1.plot(data[:, 0], sim_e0[:, 1], 'r-', linewidth=2, label='Sim Predator')
    ax1.set_title(f"Before Optimization (MSE: {initial_mse:.2f})")
    ax1.legend()

    # Plot 2: Final Parameters

    sim_pend = simulation(e)

    ax2.scatter(data[:, 0], data[:, 1], s=5, label='Data Prey', alpha=0.5)
    ax2.scatter(data[:, 0], data[:, 2], s=5, label='Data Predator', alpha=0.5)
    ax2.plot(data[:, 0], sim_pend[:, 0], 'b-', linewidth=2, label='Sim Prey')
    ax2.plot(data[:, 0], sim_pend[:, 1], 'r-', linewidth=2, label='Sim Predator')
    ax2.set_title(f"After Optimization (MSE: {curr_mse:.2f})")
    ax2.legend()

    plt.show()
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Why might it not fit perfectly?**

    Gradient descent might struggle here because the optimization landscape is "bumpy" or has different scales. The parameters $a, b, c, d$ affect the frequency and amplitude of the oscillations in complex, coupled ways. A small change in one parameter might shift the phase of the wave entirely, causing the MSE to spike momentarily before it gets better, which can trap basic gradient descent in local minima.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(i): Uniqueness of Parameters
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    Parameter values that perfectly fit the data (MSE = 0), these parameters would likely be unique.

    In the Lotka-Volterra model, the parameters $a, b, c, d$ correspond to specific physical rates:

    1. $a$ is the exponential growth rate of prey.
    2. $d$ is the exponential decay rate of predators.
    3. $b$ and $c$ determine the interaction strength.

    These four numbers uniquely determine the period, amplitude, and center point of the population cycles. Since the data represents a specific trajectory with a defined period and amplitude, there is typically only one set of constants $a, b, c, d$ that could generate that exact curve. While some biological models have "sloppy" parameters (many combinations give similar fits), a perfect fit ($MSE=0$) for this specific system implies you have recovered the exact constants used to generate the data.
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    # Question 5
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(a): Deriving $\rho$ and its Biological Meaning
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Mathematical Derivation**

    1. Definitions:
        1. $u_2 = \frac{N_2}{K_2} \implies N_2 = K_2 u_2$
        2. $\tau = r_1 t \implies t = \frac{\tau}{r_1} \implies \frac{dt}{d\tau} = \frac{1}{r_1}$

    2. Using the chain rule, we can relate the time derivative $\frac{d}{dt}$ to the nondimensional time derivative $\frac{d}{d\tau}$:$$\frac{du_2}{d\tau} = \frac{du_2}{dt} \cdot \frac{dt}{d\tau} = \left( \frac{1}{K_2} \frac{dN_2}{dt} \right) \cdot \frac{1}{r_1}$$$$\frac{du_2}{d\tau} = \frac{1}{r_1 K_2} \dot{N}_2$$
    3. Substitute the original equation for $\dot{N}_2$:$$\dot{N}_2 = r_2 N_2 \left( 1 - \frac{N_2}{K_2} - b_{21} \frac{N_1}{K_2} \right)$$
    Into our expression for $\frac{du_2}{d\tau}$:$$\frac{du_2}{d\tau} = \frac{1}{r_1 K_2} \left[ r_2 N_2 \left( 1 - \frac{N_2}{K_2} - b_{21} \frac{N_1}{K_2} \right) \right]$$

    4.  Convert variables ($N \to u$):Substitute $N_2 = K_2 u_2$ and $N_1 = K_1 u_1$:$$\frac{du_2}{d\tau} = \frac{r_2}{r_1 K_2} (K_2 u_2) \left( 1 - u_2 - b_{21} \frac{K_1 u_1}{K_2} \right)$$Simplify by canceling $K_2$:$$\frac{du_2}{d\tau} = \frac{r_2}{r_1} u_2 \left( 1 - u_2 - \left( b_{21} \frac{K_1}{K_2} \right) u_1 \right)$$

    5. Comparison:The problem states the final form is:$$\frac{du_2}{d\tau} = \rho u_2 (1 - u_2 - a_{21} u_1)$$where $a_{21} = b_{21} \frac{K_1}{K_2}$.By comparing the coefficients, we can see that:$$\rho = \frac{r_2}{r_1}$$
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    **Biological Interpretation**

    1.  $\rho$ represents the ratio of the intrinsic growth rates.
    2.  Specifically, it describes how fast Species 2 reproduces and grows relative to Species 1.
    3.  If $\rho > 1$, Species 2 reproduces faster than Species 1. If $\rho < 1$, Species 2 reproduces more slowly. This scaling factor effectively "speeds up" or "slows down" the time for the second equation relative to the first.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(b): Simulation of Species Competition
    """)
    return


@app.cell
def _(plt, solve):
    def make_competition_model(params):
        """
        Returns a model function f(x, t) for the given parameters.
        params = [rho, a12, a21]
        """
        rho, a12, a21 = params

        def model(x, t):
            u1, u2 = x

            du1 = u1 * (1 - u1 - a12 * u2)
            du2 = rho * u2 * (1 - u2 - a21 * u1)
            return [du1, du2]

        return model

    # Initial conditions: u1(0) = 0.1, u2(0) = 0.1
    x0 = [0.1, 0.1]

    # Parameters: a12 = 0.9, a21 = 1.1, rho = 1.6
    rho_val = 1.6
    a12_val = 0.9
    a21_val = 1.1
    params_b = [rho_val, a12_val, a21_val]

    # Defining the time span
    t_spam = (0, 50)


    comp_model = make_competition_model(params_b)

    # Using the 'solve' function in Q4
    ta, result = solve(comp_model, t_spam, x0)
    u1_data = result[:, 0]
    u2_data = result[:, 1]

    plt.figure(figsize=(10, 6))
    plt.plot(ta, u1_data, label='Species 1 (u1)', linewidth=2, color='blue')
    plt.plot(ta, u2_data, label='Species 2 (u2)', linewidth=2, color='orange')

    plt.title(f"Competition Model: ρ={rho_val}, a12={a12_val}, a21={a21_val}")
    plt.xlabel("Dimensionless Time (τ)")
    plt.ylabel("Population Density (u)")
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.show()
    return (make_competition_model,)


@app.cell
def _(mo):
    mo.md(r"""
    The results settle into three distinct categories when the parameters are changed.

    **Exclusion:** One species wins, the other dies.

    **Coexistence:** Both species settle at a stable positive number.

    **Bistability:** Who wins depends on who started with more population.
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(c) Analysis of Survival Factors
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    1. **The Conclusion:**
    Based on the simulations, the degree to which a species is suppressed by its competitor (represented by the interaction terms $a_{12}$ and $a_{21}$) is more important for long-term survival than its natural growth rate ($\rho$).

         *The values of $a_{12}$ and $a_{21}$ relative to 1 determine the stability of the fixed points.*
        1. If $a_{21} > 1$ and $a_{12} < 1$, Species 1 will generally drive Species 2 to extinction, regardless of how fast Species 2 tries to grow.
        2. Conversely, if we look at the case where Species 2 is the stronger competitor ($a_{12} > 1$) but grows slowly ($\rho < 1$), Species 2 will still win eventually. The growth rate $\rho$ mainly affects how fast the dynamics happen, not what the outcome is.
    2. **Supporting Simulation Code**
       To support this conclusion, we will plot the simulation for the parameter set:
    $a_{12} = 1.1, a_{21} = 0.9, \rho = 0.6$.

        In this scenario:

       1. $\rho = 0.6$: Species 2 has a lower natural growth rate than Species 1.
       2. $a_{12} = 1.1$: Species 2 suppresses Species 1 strongly ($>1$).
       3. Result: Species 2 wins (population goes to 1) and Species 1 dies out, simply because it is the stronger competitor, proving that competitive strength trumps growth speed.
    """)
    return


@app.cell
def _(make_competition_model, plt, solve):
    # Simulation supporting the conclusion 


    # Species 2 grows slower (rho=0.6) but competes stronger (a12=1.1, a21=0.9)
    rho_c = 0.6
    a12_c = 1.1
    a21_c = 0.9
    params_c = [rho_c, a12_c, a21_c]

    # Initial conditions
    xi0 = [0.1, 0.1]
    t_spab = (0, 100) 

    # Run simulation
    model_c = make_competition_model(params_c)
    ts_c, result_c = solve(model_c, t_spab, xi0)

    # Plot
    plt.figure(figsize=(10, 6))
    plt.plot(ts_c, result_c[:, 0], label='Species 1 (u1)', linewidth=2, color='blue')
    plt.plot(ts_c, result_c[:, 1], label='Species 2 (u2)', linewidth=2, color='orange')

    plt.title(f"Conclusion: Competitor strength matters more than growth rate\n(ρ={rho_c}, a12={a12_c}, a21={a21_c})")
    plt.xlabel("Dimensionless Time (τ)")
    plt.ylabel("Population Density (u)")
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.show()
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(d): Calculation and Interpretation of Fixed Points
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    Fixed points occur where the population populations stop changing, meaning $\frac{du_1}{d\tau} = 0$ and $\frac{du_2}{d\tau} = 0$.

    **The Equations:**

    1. $$u_1 (1 - u_1 - a_{12}u_2) = 0$$

    2. $$\rho u_2 (1 - u_2 - a_{21}u_1) = 0$$

     These simultaneously to find the four fixed points:

    1. **The Trivial Solution (Both Zero)**Set $u_1 = 0$ and $u_2 = 0$.

        Fixed Point 1: $(0, 0)$

           Interpretation: Total Extinction. Both species died out.
    2. **Species 1 Monoculture**

           Set$u_2 = 0$. The first equation becomes $u_1(1 - u_1) = 0$, so $u_1 = 1$.

           Fixed Point 2: $(1, 0)$

           Interpretation: Exclusion by Species 1. Species 1 survives alone at its carrying capacity, and Species 2 is extinct.
    3. **Species 2 Monoculture**

         Set $u_1 = 0$. The second equation becomes $\rho u_2(1 - u_2) = 0$, so $u_2 = 1$.

           Fixed Point 3: $(0, 1)$

           Interpretation: Exclusion by Species 2. Species 2 survives alone at its carrying capacity, and Species 1 is extinct.
    6. **Coexistence**

           Assume $u_1 \neq 0$ and $u_2 \neq 0$. We must solve the system of linear equations inside the brackets:

       1. $1 - u_1 - a_{12}u_2 = 0 \implies u_1 + a_{12}u_2 = 1$
       2. $1 - u_2 - a_{21}u_1 = 0 \implies a_{21}u_1 + u_2 = 1$

           Solving this simultaneous system yields:$$u_1^* = \frac{1 - a_{12}}{1 - a_{12}a_{21}}, \quad u_2^* = \frac{1 - a_{21}}{1 - a_{12}a_{21}}$$

          Fixed Point 4: $\left( \frac{1 - a_{12}}{1 - a_{12}a_{21}}, \frac{1 - a_{21}}{1 - a_{12}a_{21}} \right)$

          Interpretation: Coexistence Equilibrium. Both species survive together at specific population densities. (This point is only biologically relevant if both $u_1$ and $u_2$ are positive).
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    #Part(e): Calculation of the Jacobian Matrix
    """)
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(r"""
    Partial derivatives of functions $\dot{u}_1 = f_1(u_1, u_2)$ and $\dot{u}_2 = f_2(u_1, u_2)$ with respect to $u_1$ and $u_2$.

    1. **Expanding the Equations:**

        $$f_1(u_1, u_2) = u_1 - u_1^2 - a_{12}u_1u_2$$


        $$f_2(u_1, u_2) = \rho u_2 - \rho u_2^2 - \rho a_{21}u_1u_2$$

    3. **Calculate Partial Derivatives:**

            Top-Left ($\frac{\partial f_1}{\partial u_1}$):
                $\frac{\partial}{\partial u_1}(u_1 - u_1^2 - a_{12}u_1u_2) = 1 - 2u_1 - a_{12}u_2$


                Top-Right ($\frac{\partial f_1}{\partial u_2}$):
                $\frac{\partial}{\partial u_2}(u_1 - u_1^2 - a_{12}u_1u_2) = -a_{12}u_1$

                Bottom-Left ($\frac{\partial f_2}{\partial u_1}$):
                $\frac{\partial}{\partial u_1}(\rho u_2 - \rho u_2^2 - \rho a_{21}u_1u_2) = -\rho a_{21}u_2$

                Bottom-Right ($\frac{\partial f_2}{\partial u_2}$):
                $\frac{\partial}{\partial u_2}(\rho u_2 - \rho u_2^2 - \rho a_{21}u_1u_2) = \rho - 2\rho u_2 - \rho a_{21}u_1 = \rho(1 - 2u_2 - a_{21}u_1)$


    4. **The Final Jacobian Matrix:**

    $$J(u_1, u_2) = \begin{pmatrix} 1 - 2u_1 - a_{12}u_2 & -a_{12}u_1 \\ -\rho a_{21}u_2 & \rho(1 - 2u_2 - a_{21}u_1) \end{pmatrix}$$
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    #part(f): Stability Analysis and Requirements
    """)
    return


@app.cell
def _(mo):
    mo.md(r"""
    1. **Evaluating the Jacobian at the Fixed Points**

           Jacobian matrix: $$J(u_1, u_2) = \begin{pmatrix} 1 - 2u_1 - a_{12}u_2 & -a_{12}u_1 \\ -\rho a_{21}u_2 & \rho(1 - 2u_2 - a_{21}u_1) \end{pmatrix}$$

           Species 1 Wins $(1, 0)$ and Species 2 Wins $(0, 1)$

        **Fixed Point A**: $(1, 0)$ (Species 1 only)Substitute $u_1=1, u_2=0$ into $J$:$$J(1, 0) = \begin{pmatrix} 1 - 2(1) - 0 & -a_{12}(1) \\ 0 & \rho(1 - 0 - a_{21}(1)) \end{pmatrix} = \begin{pmatrix} -1 & -a_{12} \\ 0 & \rho(1 - a_{21}) \end{pmatrix}$$

        Eigenvalues: Since this is an upper triangular matrix, the eigenvalues are simply the diagonal elements:

           $\lambda_1 = -1$

           $\lambda_2 = \rho(1 - a_{21})$

        Stability Condition: For stability, all eigenvalues must be negative ($\lambda < 0$).

           $\lambda_1 = -1$ is always negative.


           $\lambda_2 < 0 \implies \rho(1 - a_{21}) < 0$. Since $\rho > 0$, we need $1 - a_{21} < 0$, or $a_{21} > 1$.


        **Fixed Point B**: $(0, 1)$ (Species 2 only)
        Substitute $u_1=0, u_2=1$ into $J$:

        $$J(0, 1) = \begin{pmatrix} 1 - 0 - a_{12}(1) & 0 \\ -\rho a_{21}(1) & \rho(1 - 2(1) - 0) \end{pmatrix} = \begin{pmatrix} 1 - a_{12} & 0 \\ -\rho a_{21} & -\rho \end{pmatrix}$$

           **Eigenvalues**: This is a lower triangular matrix, so eigenvalues are the diagonals:

           $\lambda_1 = 1 - a_{12}$

           $\lambda_2 = -\rho$

           **Stability Condition**:

           $\lambda_2 = -\rho$ is always negative (assuming positive growth rate).

           $\lambda_1 < 0 \implies 1 - a_{12} < 0$, or $a_{12} > 1$.

    2. **Application to the Given Parameters**

        **Case 1**: $a_{12} = 0.9, a_{21} = 1.1$

        Check $(1, 0)$: Stability requires $a_{21} > 1$. Since $1.1 > 1$, this point is Stable.

        Check $(0, 1)$: Stability requires $a_{12} > 1$. Since $0.9 < 1$, this point is Unstable.

        Outcome: **Species 1 wins** (consistent with simulations).


        **Case 2**: $a_{12} = 1.1, a_{21} = 0.9$

        Check $(1, 0)$: Stability requires $a_{21} > 1$. Since $0.9 < 1$, this point is Unstable.

        Check $(0, 1)$: Stability requires $a_{12} > 1$. Since $1.1 > 1$, this point is Stable.

        Outcome: **Species 2 wins**.


    3.  **Final Answer: Stability Requirements**



           For the fixed point $(1, 0)$ to be stable, we require $a_{21} > 1$. (Species 1 effectively suppresses Species 2).

           For the fixed point $(0, 1)$ to be stable, we require $a_{12} > 1$. (Species 2 effectively suppresses Species 1).
    """)
    return


if __name__ == "__main__":
    app.run()
